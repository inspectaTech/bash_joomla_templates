#!/bin/bash
#Joomla component_maker template
# first bash/shell scripting url
# http://linuxcommand.org/lc3_wss0010.php

echo "what is the file title of your component/module (use '_' underscore no spaces)? "
echo "(for example test_Mod) : "
read component_name
#to lowercase - folio
component_name=${component_name,,}
#shortcut to component_name - still folio
cn=$component_name
#to uppercase - FOLIO
cn_caps=${component_name^^}

#to initial caps - Folio
cn_init=${component_name^}

#full version with com_ added as a prefix - com_folio
cn_full="com_"$component_name

#all caps with COM_ - COM_FOLIO
cn_full_caps="COM_"$cn_caps
my_year=$(date +%Y)
my_month_year=$(date +%m-%Y)

echo "what is the official title of your component/module (spaces allowed here)? "
echo "(for example: Test component)"
read official_title

echo "what is the name of the template you will be using with this component? "
read template_name

echo "what would you like the path to your component to be?"
echo "(it will be added to the url index.php/custom-name for example: 'basic-test-page' or 'basic/test') "
read custom_path

echo "what title would you like to describe you component page?"
echo " (word or phrase - spaces are allowed for example: 'basic test page' ) "
read component_title

echo "what is the authors name? (spaces allowed here)? "
read authors_name

echo "what email address would you like to associate with this component? "
read display_email

echo "what web address would you like to associate with this component? "
read display_url

echo "what company name would you like to associate with this component? "
read company_name

#/********** MODULE VARIABLES ***********************************************/

#echo "what is the file title of your module (_underscore no spaces)? "
#echo "(for example test_Mod) : "
#read module_name
module_name=$cn
#to lowercase
module_name=${module_name,,}
#to uppercase
mn_caps=${module_name^^}
#to initial caps
mn_init=${module_name^}

#full version with mod_ added as a prefix
mn_full="mod_"$module_name

#all caps with MOD_
mn_full_caps="MOD_"$mn_caps
my_year=$(date +%Y)
my_month_year=$(date +%m-%Y)

#echo "what is the file title of the component associated with this module(_underscore no spaces)? "
#echo "(don't include 'com_'  for example test_Comp) : "
#read component_name;

#echo "what is the official title of your module (spaces allowed here)? "
#echo "(for example Test Module)"
#read official_title

official_title_mod=$official_title" module"


#template_name="'$template_name'"

#make the package file
mkdir "pkg_"$cn"_v1.0.0"
#go into the package file
cd "pkg_"$cn"_v1.0.0"

#make the xml file
echo '<?xml version="1.0" encoding="utf-8" ?>
<extension type="package"
version="3.0">
    <name>'$official_title'</name><!-- Latest Extensions -->
    <creationDate>'$my_month_year'</creationDate>
    <packagename>'$cn'</packagename>
    <author>'$authors_name'</author>
    <authorEmail>'$display_email'</authorEmail>
    <authorUrl>'$display_url'</authorUrl>
    <copyright> (c) '$my_year' '$company_name' llc. All rights reserved.</copyright>
    <license></license>
    <version>1.0.0</version>
    <packager>'$authors_name'</packager>
    <packageUrl>'$display_url'</packageUrl>
    <description>Single install package combining the component template and the module template</description>
    <files folder="packages">
    <file type="component" id="'$cn'">'$cn_full'_v1.0.0.zip</file>
    <file type="module" id="'$cn'">'$mn_full'_v1.0.0.zip</file>
    </files>
</extension>' > "pkg_"$cn".xml"

#make the pkg directory
mkdir "packages"
#enter the packages directory
cd "packages"

mkdir $cn_full"_v1.0.0"
cd $cn_full"_v1.0.0"

echo '<?php

defined("_JEXEC") or die;

class '$cn_full'InstallerScript /*com_folioInstallerScript*/
{
    function install($parent)
    {
        //JFactory::getDocument()->addScriptDeclaration("alert(\" parent is ".$parent."\")");
        $parent->getParent()->setRedirectURL("index.php?option='$cn_full'");
    }

    function uninstall($parent)
    {
        echo "<p>" . JText::_("'$cn_full_caps'_UNINSTALL_TEXT") . "</P>";
    }

    function update($parent)
    {
        echo "<p>" . JText::_("'$cn_full_caps'_UPDATE_TEXT") . "</P>";
    }

    function preflight($type, $parent)
    {
        echo "<p>" . JText::_("'$cn_full_caps'_PREFLIGHT_" . $type . "_TEXT") . "</P>";
    }

    function postflight($type, $parent)
    {
        echo "<p>" . JText::_("'$cn_full_caps'_POSTFLIGHT_" . $type . "_TEXT") . "</P>";
    }
}' > "script.php"

echo "<!DOCTYPE html><title></title>" > "index.html"
echo '<?xml version="1.0" encoding="utf-8"?>
    <extension type="component" version="3.0" method="upgrade">
    <name>'$cn_full'</name><!-- com_folio  this is used as the name on the component folder-->
    <author>'$authors_name'</author>
    <creationDate>'$my_month_year'</creationDate>
    <copyright> (c) '$my_year' '$company_name' llc. All rights reserved.</copyright>
    <authorEmail>'$display_email'</authorEmail>
    <authorUrl>'$display_url'</authorUrl>
    <version>1.0.0</version>
    <description>'$cn_full_caps'_XML_DESCRIPTION</description>
    <scriptfile>script.php</scriptfile>

    <install>
        <sql>
            <file driver="mysql" charset="utf8">sql/install.mysql.utf8.sql</file>
        </sql>
    </install>
    <uninstall>
        <sql>
            <file driver="mysql" charset="utf8">sql/uninstall.mysql.utf8.sql</file>
        </sql>
    </uninstall>

    <files folder="site">
            <filename>index.html</filename>
            <filename>controller.php</filename>
            <filename>'$component_name'.php</filename><!-- folio.php  -->
            <folder>controllers</folder>
            <folder>language</folder>
            <folder>models</folder>
            <folder>tables</folder>
            <folder>views</folder>
            <folder>xfiles</folder>
    </files>
    <languages folder="site">
        <language tag="en-GB">language/en-GB/en-GB.'$cn_full'.ini</language><!-- en-GB.com_folio.ini  -->
    </languages>
    <administration>
        <menu img="class:categories">'$cn_full_caps'_MENU</menu><!-- This is title you want to appear in the admin drop down menu -->
        <files folder="admin">
           <filename>index.html</filename>
           <filename>access.xml</filename>
           <filename>config.xml</filename>
           <filename>controller.php</filename>
           <filename>'$component_name'.php</filename><!-- folio.php  -->
		   <filename>script.php</filename>
           <folder>controllers</folder>
           <folder>helpers</folder>
           <folder>models</folder>
		   <folder>language</folder>
           <folder>sql</folder>
           <folder>tables</folder>
           <folder>views</folder>
           <folder>xfiles</folder>
        </files>
        <languages folder="admin">
        <language tag="en-GB">language/en-GB/en-GB.'$cn_full'.ini</language><!-- en-GB.com_folio.ini  -->
        <language tag="en-GB">language/en-GB/en-GB.'$cn_full'.sys.ini</language><!-- en-GB.com_folio.sys.ini  -->
        </languages>
    </administration>
    </extension>' > $component_name".xml"
#ADMIN SECTION START
mkdir "admin"
cd "admin"
echo "<!DOCTYPE html><title></title>" > "index.html"

mkdir "controllers"
cd "controllers"

echo "<!DOCTYPE html><title></title>" > "index.html"
echo '<?php
defined("_JEXEC") or die;

class '$cn_init'Controller'$cn_init' extends JControllerForm
{
    //FolioControllerFolio extends JControllerForm

}' > $component_name".php"
echo '<?php
defined("_JEXEC") OR die;

/*b.Loc 1957*/
//i think i added an s here that it didnt need
class '$cn_init'Controller'$cn_init's extends JControllerAdmin
{
    //FolioControllerFolios extends JControllerAdmin
    //has the form of componentNameControllerViewName
    public function getModel($name = "'$cn_init'", $prefix = "'$cn_init'Model",
    $config = array("ignore_request" => true))
    {//$name = "Folio", $prefix = "FolioModel",
        $model = parent::getModel($name, $prefix, $config);
        return $model;
    }
}' > $component_name"s.php"

#backout controllers
cd ..

mkdir "helpers"
cd "helpers"
echo "<!DOCTYPE html><title></title>" > "index.html"

echo '<?php
defined("_JEXEC") or die;

Class '$cn_init'Helper   //FolioHelper
{
    public static function getActions($categoryId = 0)
    {
        $user = JFactory::getUser();
        $result = new JObject;

        if(empty($categoryId))
        {
            $assetName = "'$cn_full'";//$assetName = "com_folio";
            $level = "component";
        }
        else
        {
            //I think int($categoryId);
            $assetName = "'$cn_full'.category.".(int)$categoryId;//$assetName = "com_folio.category
            $level = "category";
        }

        $actions = JAccess::getActions("'$cn_full'", $level);//getActions("com_folio"

        foreach($actions as $action)
        {
            $result->set($action->name, $user->authorise($action->name, $assetName));
        }

        return $result;

        }
    }' > $component_name".php"

#backout helpers
cd ..

mkdir "language"
cd "language"
echo "<!DOCTYPE html><title></title>" > "index.html"
mkdir "en-GB"
cd "en-GB"
echo "<!DOCTYPE html><title></title>" > "index.html"

#'$cn_full_caps'_TITLE_'$cn_caps' controlls the admin view title
echo $cn_full_caps'_COMPONENT_LABEL = "'$cn_init's "
'$cn_full_caps'_COMPONENT_DESC = "A simple '$component_name's component."
JGLOBAL_FIELD_TITLE_DESC = "'$official_title's item must have a title"
'$cn_full_caps'_FIELD_ALIAS_DESC = "The alias is for internal use only.
Leave this blank and joomla will fill in a default value from the title.
It has to be unique for each '$official_title's item in the same category."
'$cn_full_caps'_MANAGER_'$cn_caps'S = "'$cn_init's Manager: '$cn_init's"
'$cn_full_caps'_MANAGER_'$cn_caps' = "Manage '$official_title'"
'$cn_full_caps'_TITLE_'$cn_caps' = "'$official_title'"
'$cn_full_caps'_EDIT_'$cn_caps' = "Edit '$official_title'"
'$cn_full_caps'_NEW_'$cn_caps' = "New '$official_title'"

'$cn_full_caps'_FIELD_MYMENUITEM_DESC="Use the dropdown field to populate the menu hierarchy"
'$cn_full_caps'_FIELD_MYMENUITEM_LABEL="Menu"

'$cn_full_caps'_FIELD_CATID_LABEL="Category"
'$cn_full_caps'_FIELD_CATID_DESC="The category the menus belong to"

'$cn_full_caps'_FIELD_ICON_LABEL="Icon"
'$cn_full_caps'_FIELD_ICON_DESC="Icon displayed on the menu"

'$cn_full_caps'_FIELD_COMPANY_LABEL="Company"
'$cn_full_caps'_FIELD_COMPANY_DESC="The company name of the folio item"

'$cn_full_caps'_FIELD_PHONE_LABEL="Phone"
'$cn_full_caps'_FIELD_PHONE_DESC="The phone number of the company"

'$cn_full_caps'_FIELD_URL_LABEL="Url"
'$cn_full_caps'_FIELD_URL_DESC="The url link for this item"

'$cn_full_caps'_FIELD_DISPLAY-TEXT_LABEL="Display Text?"
'$cn_full_caps'_FIELD_DISPLAY-TEXT_DESC="Choose hide for a menu with no displayed text"

'$cn_full_caps'_FIELD_BUTTON-INFO_LABEL="Button title"
'$cn_full_caps'_FIELD_BUTTON-INFO_DESC="The text that is displayed when the mouse hovers over the menu."

'$cn_full_caps'_FIELD_DISABLE-MENU_LABEL="Disable menu?"
'$cn_full_caps'_FIELD_DISABLE-MENU_DESC="Choose yes to keep this menu out of the display"

'$cn_full_caps'_FIELD_CUSTOM-TITLE_LABEL="Custom Title"
'$cn_full_caps'_FIELD_CUSTOM-TITLE_DESC="Overwrite the default menu title"

'$cn_full_caps'_FIELD_DISPLAY-ICON_LABEL="Display Icon?"
'$cn_full_caps'_FIELD_DISPLAY-ICON_DESC="Choose hide for a menu with no displayed icon"

'$cn_full_caps'_FIELD_ICON-POSITION_LABEL="Icon position"
'$cn_full_caps'_FIELD_ICON-POSITION_DESC="choose left, center or right to postion the icon"

'$cn_full_caps'_FIELD_SITE_TEMPLATE1_LABEL="jQueryMobile"
'$cn_full_caps'_FIELD_SITE_TEMPLATE1_DESC="Select the JQuery mobile template style to use with this menu"

'$cn_full_caps'_FIELD_SITE2_TEMPLATE2_LABEL="Bootstrap"
'$cn_full_caps'_FIELD_SITE2_TEMPLATE2_DESC="Select the Bootstrap template style to use with this menu"

'$cn_full_caps'_FIELD_DESCRIPTION_DESC="I don'"'"'t know"


'$cn_full_caps'_HEADING_MODULEID="module id"

'$cn_full_caps'_HEADING_PUBLISHED="published"

'$cn_full_caps'_HEADING_POSITION="position"
'$cn_full_caps'_N_ITEMS_DELETED="items deleted"
' > "en-GB."$cn_full".ini"



#$cn_full_caps here controls the extension mngr menu title and the '$cn_full_caps'_MENU along with the xml file controls the drop down menu
echo $cn_full_caps' = "'$official_title'"
'$cn_full_caps'_XML_DESCRIPTION = "A simple port'$component_name' extension."
'$cn_full_caps'_MENU = "'$official_title'"
'$cn_full_caps'_'$cn_caps'S_VIEW_DEFAULT_DESC = "Show all the '$component_name' items"
'$cn_full_caps'_'$cn_caps'S_VIEW_DEFAULT_OPTION = "Default"
'$cn_full_caps'_'$cn_caps'S_VIEW_DEFAULT_TITLE = "Show all '$component_name' items"' > "en-GB."$cn_full".sys.ini"

#backout en-GB & language
cd ../..

mkdir "models"
cd "models"
echo "<!DOCTYPE html><title></title>" > "index.html"

echo '<?php
defined("_JEXEC") or die;


class '$cn_init'Model'$cn_init' extends JModelAdmin  //FolioModelFolio extends JModelAdmin
{
    protected $text_prefix = "'$cn_full_caps'";//$text_prefix = "COM_FOLIO";

    public function getTable($type = "'$cn_init'", $prefix = "'$cn_init'Table",/*type = "Folio", $prefix = "FolioTable"*/
    $config = array())
    {
        return JTable::getInstance($type, $prefix, $config);
    }

    public function getForm($data = array(), $loadData = true)
    {
        $app = JFactory::getApplication();

        $form = $this->loadForm("'$cn_full'.'$component_name'", "'$component_name'", array("control" =>
        "jform", "load_data" => $loadData));//loadForm("com_folio.folio", "folio",
            if(empty($form))
            {
                return false;
            }

            return $form;

    }

    protected function loadFormData()
    {
        $data = JFactory::getApplication()->getUserState("'$cn_full'.edit.'$component_name'.data",array());//getUserState("com_folio.edit.folio.data"

        if(empty($data))
        {
            $data = $this->getItem();
        }

        return $data;
    }

    protected function prepareTable($table)
    {
        $table->title = htmlspecialchars_decode($table->title, ENT_QUOTES);
    }
}' > $component_name".php"

echo '<?php
defined("_JEXEC") or die;

/* Creating the model for the list view

  b.Loc 1981  */

class '$cn_init'Model'$cn_init's extends JModelList //FolioModelFolios extends JModelList
{
    public function __construct($config = array())
    {
        if(empty($config["filter_fields"]))
        {
          $config["filter_fields"]= array(
          "id","a.id",
          "title","a.title",
          "module_id","a.module_id",
          "options","a.options",
          "position","b.position",
          "access","b.access",
          "published","b.published",
          "publish_up","b.publish_up",
          "publish_down","b.publish_down"
          );
        }

        parent::__construct($config);
    }

    protected function getListQuery()
    {
        $db = $this->getDbo();
        $query = $db->getQuery(true);

        $query->select(
            $this->getState(
            "list.select",
            "a.id, a.title," .
            "a.options, a.module_id,".
            "b.position,b.access,b.published,".
            "b.publish_up,b.publish_down"
            )
        );

        $query->from($db->quoteName("#__'$cn'","a"))
        ->join("INNER",$db->quoteName("#__modules","b") . "ON (" .
        $db->quoteName("a.id") . " = " . $db->quoteName("b.'$cn'_id") . ")");//("#__folio")." AS a");

        return $query;
    }
}' > $component_name"s.php"

mkdir "forms"
cd "forms"
echo "<!DOCTYPE html><title></title>" > "index.html"
echo '<?xml version="1.0" encoding="utf-8"?>
<!-- Creating a form b.loc 2060 -->
<form>
    <fieldset>

        <field name="id" type="text" default="0" label="JGLOBAL_FIELD_ID_LABEL"
        readonly="true" class="readonly" description="JGLOBAL_FIELD_DESC"/>

        <field name="title" type="text" class="inputbox span8"
        label="JGLOBAL_TITLE" description="JGLOBAL_FIELD_TITLE_DESC"
        required="true" message="some text" />

        <field name="alias" type="text" class="inputbox" size="40"
        label="JFIELD_ALIAS_LABEL" description="'$cn_full_caps'_FIELD_ALIAS_DESC" />
        <!-- description="COM_FOLIO_FIELD_ALIAS_DESC" -->
        <!-- description defined in language file -->

        <!-- required was "true" but won'"'"'t allow u to save even if not on the page -->
        <field name="mymenuitem" type="menuitem" class="span12 mymenuitem"  description="'$cn_full_caps'_FIELD_MYMENUITEM_DESC"
        label="'$cn_full_caps'_FIELD_MYMENUITEM_LABEL" required="false" />

        <!-- I need a module style page dropdown -->
        <field name="catid" type="category" extension="'$cn_full'" class="inputbox" default=""
        label="'$cn_full_caps'_FIELD_CATID_LABEL" description="'$cn_full_caps'_FIELD_CATID_DESC">
            <option value="0">
            JOPTION_SELECT_CATEGORY
            </option>
        </field>

        <!-- STATUS DROPDOWN? -->
        <field name="state" type="list" extension="'$cn_full'" class="inputbox small" default="1" size="1"
        label="JSTATUS" description="JFIELD_PUBLISHED_DESC" >
            <option value="1">SMULVISHED</option><!-- JPUBLISHED -->
            <option value="0">JUNPUBLISHED</option>
            <option value="2">JARCHIVED</option>
            <option value="-2">JTRASHED</option>
        </field>

        <!-- Image field -->
        <field name="icon" type="media" directory="" hide_none="1" class="inputbox" default=""
        label="'$cn_full_caps'_FIELD_ICON_LABEL" description="'$cn_full_caps'_FIELD_ICON_DESC" size="40" />

        <!-- Company field  required="true"-->
        <field name="company" type="text" class="inputbox" size="40" directory=""
        label="'$cn_full_caps'_FIELD_COMPANY_LABEL" description="'$cn_full_caps'_FIELD_COMPANY_DESC" />

        <!-- phone field required="true" -->
        <field name="phone" type="text" class="inputbox" size="40" directory=""
        label="'$cn_full_caps'_FIELD_PHONE_LABEL" description="'$cn_full_caps'_FIELD_PHONE_DESC" />

        <field name="url" type="text" description="'$cn_full_caps'_FIELD_URL_DESC"
        label="'$cn_full_caps'_FIELD_URL_LABEL"  size="40" maxlength="255" />

        <field name="description" type="textarea" class="inputbox" rows="3" cols="30" label="JGLOBAL_DESCRIPTION"
        description="'$cn_full_caps'_FIELD_DESCRIPTION_DESC" />

        <field name="disable_menu" type="radio" class="btn-group" label="'$cn_full_caps'_FIELD_DISABLE-MENU_LABEL"
        labelclass="control-label" default="1" description="'$cn_full_caps'_FIELD_DISABLE-MENU_DESC" >
        <option value="1">no</option>
        <option value="0">yes</option>
        </field>

        <field name="display_text" type="radio" class="btn-group" label="'$cn_full_caps'_FIELD_DISPLAY-TEXT_LABEL"
        labelclass="control-label" default="1"  description="'$cn_full_caps'_FIELD_DISPLAY-TEXT_DESC" >
        <option value="1">JSHOW</option>
        <option value="0">JHIDE</option>
        </field>

        <field name="display_icon" type="radio" class="btn-group display_icon" label="'$cn_full_caps'_FIELD_DISPLAY-ICON_LABEL"
        labelclass="control-label" default="1"  description="'$cn_full_caps'_FIELD_DISPLAY-ICON_DESC" >
        <option value="1" onclick="changeDisplayIcon('"'"'show'"'"');">JSHOW</option>
        <option value="0" onclick="changeDisplayIcon('"'"'hide'"'"');">JHIDE</option>
        </field>

        <field name="icon_position" type="radio" class="btn-group" label="'$cn_full_caps'_FIELD_ICON-POSITION_LABEL"
        labelclass="control-label" default="1"  description="'$cn_full_caps'_FIELD_ICON-POSITION_DESC" >
        <option value="1">Left</option>
        <option value="2">Right</option>
        </field>

        <field name="icon_position2" type="radio" class="btn-group" label="'$cn_full_caps'_FIELD_ICON-POSITION_LABEL"
        labelclass="control-label" default="1"  description="'$cn_full_caps'_FIELD_ICON-POSITION_DESC" >
        <option value="1">Left</option>
        <option value="2">Center</option>
        <option value="3">Right</option>
        </field>

        <field name="custom_title" class="custom_title" type="text" description="'$cn_full_caps'_FIELD_CUSTOM-TITLE_DESC"
        label="'$cn_full_caps'_FIELD_CUSTOM-TITLE_LABEL"  size="40" maxlength="255" />

        <field name="template1" class="template1" type="templatestyle" client="site" label="'$cn_full_caps'_FIELD_SITE_TEMPLATE1_LABEL"
        description="'$cn_full_caps'_FIELD_SITE_TEMPLATE1_DESC" />

        <field name="template2" type="templatestyle" client="site" label="'$cn_full_caps'_FIELD_SITE_TEMPLATE2_LABEL"
        description="'$cn_full_caps'_FIELD_SITE_TEMPLATE2_DESC" />

        <field name="data" type="hidden" class="inputbox data" rows="3" cols="30" />
        <field name="options" type="hidden" class="inputbox options" rows="3" cols="30" />

        <field name="access" type="accesslevel" label="who can see it"
        description="tells you who can see it" />

         <field name="status" type="list" class="inputbox small" default="1" size="1"
        label="JSTATUS" description="JFIELD_PUBLISHED_DESC" >
            <option value="1">JPUBLISHED</option><!-- JPUBLISHED -->
            <option value="0">JUNPUBLISHED</option>
        </field>

        <field name="position2" type="modulesposition"  label="COM_MODULES_FIELD_POSITION_LABEL"
        default=""  maxlength="50" />


        <field name="position" type="moduleposition" extension="'$cn_full'" label="COM_MODULES_FIELD_POSITION_LABEL"
        default="" addfieldpath="administrator/components/com_modules/models/fields" maxlength="50" />

        <field name="module_id" type="text" default="0" label="JGLOBAL_FIELD_ID_LABEL"
        readonly="true" class="readonly" description="JGLOBAL_FIELD_DESC"/>

    </fieldset>

</form>
' > $component_name".xml"
#backout forms & models
cd ../..

mkdir "sql"
cd "sql"
echo "<!DOCTYPE html><title></title>" > "index.html"
echo 'CREATE TABLE IF NOT EXISTS `#__'$component_name'` (
`id` INT(11) UNSIGNED NOT NULL AUTO_INCREMENT,
`title` VARCHAR(250) UNIQUE NOT NULL DEFAULT '"'"''"'"',
`data` TEXT NOT NULL DEFAULT '"'"''"'"',
`options` TEXT NOT NULL DEFAULT '"'"''"'"',
`module_id` INT(10) NOT NULL DEFAULT '"'"'0'"'"',
PRIMARY KEY (`id`)
 )ENGINE=InnoDB DEFAULT CHARSET=utf8 AUTO_INCREMENT=1;
 /*ENGINE=MyISAM DEFAULT CHARSET=utf8 AUTO_INCREMENT=1;*/

 ALTER TABLE `#__modules`
 ADD `'$cn'_id` int(10) NULL unique;
 ' > "install.mysql.utf8.sql"

 echo 'DROP TABLE IF EXISTS `#__'$component_name'`;
 DELETE FROM `#__menu` WHERE `menutype` = '"'"''$component_name'menu'"'"';
 DELETE FROM `#__menu_types` WHERE `menutype` = '"'"''$component_name'menu'"'"';

 ' > "uninstall.mysql.utf8.sql"
#backout sql
cd ..

mkdir "tables"
cd "tables"
echo "<!DOCTYPE html><title></title>" > "index.html"

echo '<?php
defined("_JEXEC") or die;

/*the bind function is used to prepare the data immediately
before it is saved to the database

loc 2043
*/


class '$cn_init'Table'$cn_init' extends JTable //FolioTableFolio extends JTable
{
    public function __construct(&$db)
    {
        parent::__construct("#__'$component_name'", "id", $db);//construct("#__folio"
    }

    public function bind($array, $ignore = "")
    {
        return parent::bind($array, $ignore);
    }

    /*the store function writes the data to the database when you
    submit the form*/

    public function store($updateNulls = false)
    {
        return parent::store($updateNulls);
    }
}' > $component_name".php"
echo '<?php
defined("_JEXEC") or die;

class TableModuleAssets extends JTableNested
{

    public function __construct($db)
    {
        parent::__construct("#__assets","id",$db);
    }

    public function saveNewModule($dStr)
    {
        $data_obj = json_decode($dStr);

        $db = jFactory::getDbo();
        $query = $db->getQuery(true);
        $query->select($db->quoteName("id"));
        $query->from($db->quoteName("#__'$cn'"));
        $query->where($db->quoteName("title") . " LIKE ". $db->quote($data_obj->menu_title));//'$cn' Test Page
        $db->setQuery($query);

        $menu_id = $db->loadResult();

        if($menu_id == "")
        {
            return "false";
        }//end if

        $db = jFactory::getDbo();
        $query = $db->getQuery(true);

        //insert columns
        $columns = array("title","ordering","position","published","module","access","showtitle","params","'$cn'_id");

        //insert values
        $values = array(
        $db->quote($data_obj->menu_title),
        1,
        $db->quote($data_obj->position),
        $db->quote($data_obj->status),
        $db->quote("mod_'$cn'"),
        $db->quote($data_obj->access),
        0,
        $db->quote('"'"'{"moduleclass_sfx":"","module_tag":"div","bootstrap_size":"0","header_tag":"h3","header_class":"","style":"0"}'"'"'),
        $db->quote($menu_id));


        //prep the insert query
        $query->insert($db->quoteName("#__modules"))
        ->columns($db->quoteName($columns))
        ->values(implode(",",$values));
        $db->setQuery($query);
        $db->execute();

        return $menu_id;

    }//end saveNewModule


    public function getMenuId($dStr)
    {
        $data_obj = json_decode($dStr);

        $db = jFactory::getDbo();
        $query = $db->getQuery(true);
        $query->select($db->quoteName("id"));
        $query->from($db->quoteName("#__'$cn'"));
        $query->where($db->quoteName("title") . " LIKE ". $db->quote($data_obj->menu_title));//'$cn' Test Page
        $db->setQuery($query);

        $menu_id = $db->loadResult();

        return $menu_id;

    }//end getMenuId


    public function getModuleId($idStr)
    {
        $db = jFactory::getDbo();
        $query = $db->getQuery(true);
        $query->select($db->quoteName("id"));
        $query->from($db->quoteName("#__modules"));
        $query->where($db->quoteName("'$cn'_id") . " LIKE ". $db->quote($idStr));//'$cn' Test Page
        $db->setQuery($query);

        $module_id = $db->loadResult();

        if($module_id == "")
        {
           return "false";
        }
        else
        {
            return $module_id;

        }//end if

    }//end getModuleId


    public function getAssetId($nStr)
    {
        $db = jFactory::getDbo();
        $query = $db->getQuery(true);
        $query->select($db->quoteName("id"));
        $query->from($db->quoteName("#__assets"));
        $query->where($db->quoteName("name") . " LIKE ". $db->quote($nStr));//'$cn' Test Page
        $db->setQuery($query);

        $asset_id = $db->loadResult();

        if($asset_id == "")
        {
           return "false";
        }
        else
        {
            return $asset_id;

        }//end if

    }//end getAssetId

    public function updateTables($aId,$moId,$meId,$dStr)
    {
        $data_obj = json_decode($dStr);
        //update module
        $db = jFactory::getDbo();
        $query = $db->getQuery(true);

        $fields = array
        (
        $db->quoteName("asset_id") . " = " . $db->quote($aId),
        $db->quoteName("position") . " = " . $db->quote($data_obj->position),
        $db->quoteName("published") . " = " . $db->quote($data_obj->status),
        $db->quoteName("access") . " = " . $db->quote($data_obj->access)

        );
        $conditions = array($db->quoteName("id") . " = " . $db->quote($moId));

        $query->update($db->quoteName("#__modules"))->set($fields )->where($conditions);
        $db->setQuery($query);
        $db->execute();

        //update '$cn'
        $db = jFactory::getDbo();
        $query = $db->getQuery(true);

        $fields = array($db->quoteName("module_id") . " = " . $db->quote($moId));
        $conditions = array($db->quoteName("id") . " = " . $db->quote($meId));

        $query->update($db->quoteName("#__'$cn'"))->set($fields )->where($conditions);
        $db->setQuery($query);
        $results = $db->execute();



        //create default page views in modules_menu
        $db = jFactory::getDbo();
        $query = $db->getQuery(true);

        $columns = array("moduleid","menuid");

        //insert values
        $values = array($db->quote($moId),0);

        //prep the insert query
        $query->insert($db->quoteName("#__modules_menu"))
        ->columns($db->quoteName($columns))
        ->values(implode(",",$values));
        $db->setQuery($query);
        $db->execute();


        return $results . " updates accomplished ";

    }//end updateTables

    public function updateModule($moId,$meId,$dStr)
    {
         $data_obj = json_decode($dStr);
        //update module
        $db = jFactory::getDbo();
        $query = $db->getQuery(true);

        $fields = array
        (
        $db->quoteName("position") . " = " . $db->quote($data_obj->position),
        $db->quoteName("published") . " = " . $db->quote($data_obj->status),
        $db->quoteName("access") . " = " . $db->quote($data_obj->access)
        );
        $conditions = array($db->quoteName("id") . " = " . $db->quote($moId));

        $query->update($db->quoteName("#__modules"))->set($fields )->where($conditions);
        $db->setQuery($query);
        $db->execute();

    }//end update module

    public function getModuleData($moId)
    {

        $db = jFactory::getDbo();
        $query = $db->getQuery(true);
        $query->select($db->quoteName(array("position","published","access")));
        $query->from($db->quoteName("#__modules"));
        $query->where($db->quoteName("id") . " LIKE ". $db->quote($moId));//'$cn' Test Page
        $db->setQuery($query);

        $moduleData = json_encode($db->loadObject());
        return $moduleData;


    }//end getModuleData

    public function preSaveMenu($dStr)
    {
        $data_obj = json_decode($dStr);

        $db = jFactory::getDbo();
        $query = $db->getQuery(true);

        $columns = array("title");

        //insert values
        $values = array(
        $db->quote($data_obj->menu_title));
        //prep the insert query
        $query->insert($db->quoteName("#__'$cn'"))
        ->columns($db->quoteName($columns))
        ->values($values);
        $db->setQuery($query);
        $db->execute();



    }//end preSaveMenu


    public function deleteElements($mod)
    {
        $results = "";

        for($i = 0;$i < count($mod); $i++)
        {
            //remove modules
            $db = jFactory::getDbo();
            $query = $db->getQuery(true);

            $conditions = array($db->quoteName("id") . " = " . $db->quote($mod[$i]));

            $query->delete($db->quoteName("#__modules"))->where($conditions);
            $db->setQuery($query);
            $results .= $db->execute();

            //remove asset
            $db = jFactory::getDbo();
            $query = $db->getQuery(true);

            $conditions = array($db->quoteName("name") . " = " . $db->quote("com_modules.module." . $mod[$i]));

            $query->delete($db->quoteName("#__assets"))->where($conditions);
            $db->setQuery($query);
            $results .= $db->execute();

            //remove modules_menu
             $db = jFactory::getDbo();
            $query = $db->getQuery(true);

            $conditions = array($db->quoteName("moduleid") . " = " . $db->quote($mod[$i]));

            $query->delete($db->quoteName("#__modules_menu"))->where($conditions);
            $db->setQuery($query);
            $results .= $db->execute();

        }//end for

        return $results;

    }//end deleteElements

    public function getUrls($tStr)
    {
        $db = jFactory::getDbo();
        $query = $db->getQuery(true);
        $query->select($db->quoteName(array("path","link")));
        $query->from($db->quoteName("#__menu"));
        $query->where($db->quoteName("title") . " LIKE ". $db->quote($tStr));//'$cn' Test Page
        $db->setQuery($query);

        $urlData = json_encode($db->loadObject());

        if($urlData == "" or $urlData == "null")
        {
           return "false";
        }
        else
        {
            return $urlData;

        }//end if

    }//end getUrls


    public function checkModMenu($moId)
    {
        //not really needed.  but if someone does its here.

        $db = jFactory::getDbo();
        $query = $db->getQuery(true);
        $query->select($db->quoteName("menuid"));
        $query->from($db->quoteName("#__modules_menu"));
        $query->where($db->quoteName("moduleid") . " LIKE ". $db->quote($moId));//'$cn' Test Page
        $db->setQuery($query);

        $mData = $db->loadResult();

        if($mData == "")
        {
           return "false";
        }
        else
        {
            return "true";

        }//end if


    }//end getModuleData

    public function updateModMenu($moId)
    {
        //not really needed.  but if someone does its here.

        //create default page views in modules_menu
        $db = jFactory::getDbo();
        $query = $db->getQuery(true);

        $columns = array("moduleid","menuid");

        //insert values
        $values = array($db->quote($moId),0);

        //prep the insert query
        $query->insert($db->quoteName("#__modules_menu"))
        ->columns($db->quoteName($columns))
        ->values(implode(",",$values));
        $db->setQuery($query);
        $db->execute();


        return " mod menu updated";

    }


    public function bind($array, $ignore = "")
    {
        return parent::bind($array, $ignore);
    }

    /*the store function writes the data to the database when you
    submit the form*/

    public function store($updateNulls = false)
    {
        return parent::store($updateNulls);
    }

}//end class
//end TableModuleAssets
' > "moduleassets.php"
echo '<?php
defined("_JEXEC") or die;

/*the bind function is used to prepare the data immediately
before it is saved to the database

loc 2043
*/

//Junk table for making menus


class TableMenumaker extends JTable // extends JTable
{
    public function __construct(&$db)
    {
        parent::__construct("#__menu_types", "id", $db);//construct("#__folio"
    }

    public function bind($array, $ignore = "")
    {
        return parent::bind($array, $ignore);
    }

    /*the store function writes the data to the database when you
    submit the form*/

    public function store($updateNulls = false)
    {
        return parent::store($updateNulls);
    }



    public function checkMenuData()
    {
        $db = jFactory::getDbo();
        $query = $db->getQuery(true);
        $query->select($db->quoteName("id"));
        $query->from($db->quoteName("#__menu_types"));
        $query->where($db->quoteName("menutype") . " LIKE ". $db->quote("'$component_name'menu"));//'$component_name' Test Page
        $db->setQuery($query);

        $results = $db->loadResult();

        if($results == "")
        {
           return "false";
        }
        else
        {
            return $results;

        }//end if
    }//end checkMenuData

    public function checkMenuTitle($tStr)
    {
        $db = jFactory::getDbo();
        $query = $db->getQuery(true);
        $query->select($db->quoteName("id"));
        $query->from($db->quoteName("#__'$component_name'"));
        $query->where($db->quoteName("title") . " LIKE ". $db->quote($tStr));//'$component_name' Test Page
        $db->setQuery($query);

        $results = $db->loadResult();

        if($results == "")
        {
           return "false";
        }
        else
        {
            return $results;

        }//end if
    }//end checkMenuTitle


}//end TableMenumaker' > "menumaker.php"
echo '<?php
defined("_JEXEC") or die;

class TableNestedSets extends JTableNested
{

    public function __construct($db)
    {
        parent::__construct("#__menu","id",$db);
    }



    public function addRoot()
    {
        $db = jFactory::getDbo();

       $query = $db->getQuery(true)
        ->insert("#__menu")
        ->set("parent_id = 1")
        ->set("level = 1")
        ->set("title = \"frustrating\" ");
        $db->store($query);

        if($db->execute())
        {
                return false;

        }

        //return $db->insertid();
        $sneekPeek = JFactory::getDocument();
        $sneekPeek->addScriptDeclaration("alert(\"".$query."\");");
    }


    public function checkMenuItemData()
    {
        $db = jFactory::getDbo();
        $query = $db->getQuery(true);
        $query->select($db->quoteName("id"));
        $query->from($db->quoteName("#__menu"));
        $query->where($db->quoteName("title") . " LIKE ". $db->quote("'$official_title'"));//formerly '$component_name' Test Page
        $db->setQuery($query);

        $results = $db->loadResult();

        if($results == "")
        {
           return "false";
        }
        else
        {
            return $results;

        }//end if
    }


    public function checkTemplateData($dTN)
    {
        $db = jFactory::getDbo();
        $query = $db->getQuery(true);
        $query->select($db->quoteName("id"));
        $query->from($db->quoteName("#__template_styles"));
        $query->where($db->quoteName("template") . " LIKE ". $db->quote($dTN));//'$component_name' Test Page
        $db->setQuery($query);

        $results = $db->loadResult();

        if($results == "")
        {
           return "false";
        }
        else
        {
            return $results;

        }//end if
    }

    public function checkComponentData()
    {
        $db = jFactory::getDbo();
        $query = $db->getQuery(true);
        $query->select($db->quoteName("extension_id"));
        $query->from($db->quoteName("#__extensions"));
        $query->where($db->quoteName("name") . " LIKE ". $db->quote("'$cn_full'"));//'$component_name' Test Page
        $db->setQuery($query);

        $results = $db->loadResult();

        if($results == "")
        {
           return "false";
        }
        else
        {
            return $results;

        }//end if
    }//end checkComponentData


/****************************************************************************************************************

    public function saveNewModule($dStr)
    {
        $data_obj = json_decode($dStr);

        $db = jFactory::getDbo();
        $query = $db->getQuery(true);
        $query->select($db->quoteName("id"));
        $query->from($db->quoteName("#__'$component_name'"));
        $query->where($db->quoteName("title") . " LIKE ". $db->quote($data_obj->menu_title));//'$component_name' Test Page
        $db->setQuery($query);

        $menu_id = $db->loadResult();

        $db = jFactory::getDbo();
        $query = $db->getQuery(true);

        //insert columns
        $columns = array("title","ordering","position","published","module","access","showtitle","params","'$cn'_id");

        //insert values
        $values = array(
        $db->quote($data_obj->menu_title),
        1,
        $db->quote($data_obj->position),
        $db->quote($data_obj->status),
        $db->quote("mod_'$component_name'"),
        $db->quote($data_obj->access),
        0,
        $db->quote('"'"'{"moduleclass_sfx":"","module_tag":"div","bootstrap_size":"0","header_tag":"h3","header_class":"","style":"0"}'"'"'),
        $db->quote($menu_id));


        //prep the insert query
        $query->insert($db->quoteName("#__modules"))
        ->columns($db->quoteName($columns))
        ->values(implode(",",$values));
        $db->setQuery($query);
        $db->execute();


        return $menu_id;

    }//end saveNewModule


    public function getMenuId($dStr)
    {
        $data_obj = json_decode($dStr);

        $db = jFactory::getDbo();
        $query = $db->getQuery(true);
        $query->select($db->quoteName("id"));
        $query->from($db->quoteName("#__'$component_name'"));
        $query->where($db->quoteName("title") . " LIKE ". $db->quote($data_obj->menu_title));//'$component_name' Test Page
        $db->setQuery($query);

        $menu_id = $db->loadResult();

        return $menu_id;

    }//end getMenuId


    public function getModuleId($idStr)
    {
        $db = jFactory::getDbo();
        $query = $db->getQuery(true);
        $query->select($db->quoteName("id"));
        $query->from($db->quoteName("#__modules"));
        $query->where($db->quoteName("'$cn'_id") . " LIKE ". $db->quote($idStr));//'$component_name' Test Page
        $db->setQuery($query);

        $module_id = $db->loadResult();

        return $module_id;

    }//end getModuleId

    public function saveAssets($dStr,$moId)
    {
            $data_obj = json_decode($dStr);
            $name_str = "com_modules.module." . $moId;

            $nID = array("parent_id" => "18","level" => "2","name" => $name_str,
            "title" => $data_obj->menu_title,
            '"'"'rules'"'"' => '"'"'{"core.delete":{"6":1},"core.edit":{"6":1,"4":1},"core.edit.state":{"6":1,"5":1},"module.edit.frontend":[]}'"'"'
            );

            if(!parent::getTableName("assets"))
            {$this->setError(!parent::getError());
            return false;}


           if(!parent::setLocation("18","last-child"))
            {
                $this->setError(!parent::getError());
            return false;}


            if(!parent::save($nID))
            {$this->setError(!parent::getError());
            return false;}

            return $dStr;

    }
****************************************************************************************************************/


     public function bind($array, $ignore = "")
    {
        return parent::bind($array, $ignore);
    }

    /*the store function writes the data to the database when you
    submit the form*/

    public function store($updateNulls = false)
    {
        return parent::store($updateNulls);
    }

}//end class' > "nestedsets.php"

#backout tables
cd ..

mkdir "views"
cd "views"
echo "<!DOCTYPE html><title></title>" > "index.html"

mkdir $component_name
cd $component_name
echo "<!DOCTYPE html><title></title>" > "index.html"
echo '<?php
defined("_JEXEC") or die;

class '$cn_init'View'$cn_init' extends JViewLegacy //FolioViewFolio extends
{
    /*Im still looking for the thing that initiates this FolioViewFolio class
    maybe its in the joomla framwork to look for the component names, enter its
    it code into its naming framework and run the classes by referencing the
    component titles.
    */
    protected $item;

    protected $form;

    public function display($tpl = null)
    {
        $this->item = $this->get("Item");
        //used by edit.php to perform $this->form->getLabel();
        $this->form = $this->get("Form");

        if(count($errors = $this->get("Errors")))
        {
            JError::raiseError(500, implode("\n", $errors));
            return false;
        }

        /****** This code checks for an internet connection  *******/
        $connected = @fsockopen("www.google.com",80);
        if($connected)
        {
          $is_conn = true;
          fclose($connected);
        }else
        {
          $is_conn = false;
        }
        /****************** end connection checker  ****************/

		//use this to link js and css and inject scripts into the header
		$fileLink = JFactory::getDocument();
		// Note: "JUri::" works well online and offline without confusing "\" and "/"
		$styleLoc = JUri::base() . "components/'$cn_full'/xfiles/css/'$component_name'.css";
        $fileLink->addStyleSheet($styleLoc);

		//js link
		$scriptLoc = JUri::base() . "components/'$cn_full'/xfiles/js/'$component_name'.js";
		$fileLink->addScript($scriptLoc);

		//other ways to inject a script directly into the header.
		//$JQMLink->addScriptDeclaration("alert(\" JPATH COMPONENT = " . JPATH_COMPONENT . "\");");
        //JFactory::getDocument()->addScriptDeclaration("alert(\" DIR = " . __DIR__ . "\");");




        $this->addToolbar();
        parent::display($tpl);

    }

    protected function addToolbar()
    {

        JFactory::getApplication()->input->set("hidemainmenu", true);
        //take this away later and see what happens

        JToolbarHelper::title(JText::_("'$cn_full_caps'_MANAGER_'$cn_caps'"), ""); //"COM_FOLIO_MANAGER_FOLIO"

        //important changed from '$cn'.save to '$cn'.apply for module save feature
        //change it back to '$cn'.save if you don'"'"'t need the module creation feature
        JToolbarHelper::save("'$component_name'.apply"); //"folio.save"


        if(empty($this->item->id))
        {
            JToolbarHelper::cancel("'$component_name'.cancel"); //"folio.cancel"
        }
        else
        {
            JToolbarHelper::cancel("'$component_name'.cancel","JTOOLBAR_CLOSE"); //folio.cancel
        }

    }

}' > "view.html.php"


mkdir "tmpl"
cd "tmpl"
echo "<!DOCTYPE html><title></title>" > "index.html"
echo '<?php
defined("_JEXEC") or die;

?>
<!--  -->
<form action="<?php echo JRoute::_("index.php?option='$cn_full'&layout=edit&id="
.(int) $this->item->id); ?> " method="post" name="adminForm" id="adminForm"
class="form-validate"><!-- option=com_folio&layout -->
    <div class="row-fluid">
        <div class="span10 form-horizontal">

            <fieldset>
                <?php echo JHtml::_("bootstrap.startPane", "myTab",
                array("active" => "details")); ?>

                <?php echo JHtml::_("bootstrap.addPanel", "myTab", "details",
                empty($this->item->id) ? JText::_("'$cn_full_caps'_NEW_'$cn_caps'", true) :
                JText::sprintf("'$cn_full_caps'_EDIT_'$cn_caps'", $this->item->id, true));
                //JText::_("COM_FOLIO_NEW_FOLIO"   sprintf("COM_FOLIO_EDIT_FOLIO"
                ?>

                    <div class="control-group">
                    <div class="control-label">
                    <script> //alert("<?php echo "edit.php alert " . $this ?>"); </script>

                        <?php echo $this->form->getLabel("title");
                        /*edit/new forms initial title field  and label gets data from
                        FolioViewFolio $this->form = $this->get("Form");*/
                        ?>
                    </div>
                    <div class="controls">
                      <div class="titleCont">
                          <?php echo $this->form->getInput("title");//the actual field for the title ?>
                          <div id="titleMsg" class="alert-danger" style=""></div>
                      </div>
                    </div>
                    <div class="control-group" style="display:none;">
                        <div class="control-label" style="">
                            <?php echo $this->form->getLabel("id"); //title field label ?>
                        </div>
                        <div class="controls" style="">
                            <?php echo $this->form->getInput("id"); //the actual field for the title ?>
                        </div>
                    </div>
                     <div class="control-group" style="display:none;">
                        <div class="control-label" style="">
                            <?php echo $this->form->getLabel("module_id"); //title field label ?>
                        </div>
                        <div class="controls" style="">
                            <?php echo $this->form->getInput("module_id"); //the actual field for the title ?>
                        </div>
                    </div>
                    <div class="control-group" style="display:none;">
                        <div class="control-label" style="">
                            <?php echo $this->form->getLabel("access"); //title field label ?>
                        </div>
                        <div class="controls" style="">
                            <?php echo $this->form->getInput("access"); //the actual field for the title ?>
                        </div>
                    </div>
                    <div class="control-group" style="display:none;">
                        <div class="control-label" style="">
                            <?php echo $this->form->getLabel("status"); //title field label ?>
                        </div>
                        <div class="controls" style="">
                            <?php echo $this->form->getInput("status"); //the actual field for the title ?>
                        </div>
                    </div>
                    <div class="control-group" style="display:none;">
                        <div class="control-label" style="">
                            <?php echo $this->form->getLabel("position"); //title field label ?>
                        </div>
                        <div class="controls" style="">
                            <?php echo $this->form->getInput("position"); //the actual field for the title ?>
                        </div>
                    </div>
                    </div>
                    <?php echo JHtml::_("bootstrap.endPanel"); ?>

                    <input type="hidden" name="task" value="" />
                    <?php echo JHtml::_("form.token"); ?>
                    <?php echo JHtml::_("bootstrap.endPane"); ?>
            </fieldset>
        </div>
    </div>
</form>
<script>
window["SITEURL"] = "<?php echo JUri::current(); ?>";
prepModuleEvents();
'$component_name'SampleAjax();
</script>' > "edit.php"
#backout tmpl & $component_name
cd ../..

mkdir $component_name"s"
cd $component_name"s"
echo "<!DOCTYPE html><title></title>" > "index.html"
echo '<?php
defined("_JEXEC") or die;

class '$cn_init'View'$cn_init's extends JViewLegacy  //class FolioViewFolios
{
    protected $items;


    public function display($tpl = null)
    {

        $this->items = $this->get("items");

        if(count($errors = $this->get("Errors")))
        {
            JError::raiseError(500, implode("\n", $errors));
            return false;
        }

        $this->addToolbar();
        parent::display($tpl);

        /****** This code checks for an internet connection  *******/
        $connected = @fsockopen("www.google.com",80);
        if($connected)
        {
          $is_conn = true;
          fclose($connected);
        }else
        {
          $is_conn = false;
        }
        /****************** end connection checker  ****************/

		$fileLink = JFactory::getDocument();

		$scriptLoc2 = JUri::base() . "components/'$cn_full'/xfiles/js/'$component_name's.js";
		$fileLink->addScript($scriptLoc2);

		$styleLoc2 = JUri::base() . "components/'$cn_full'/xfiles/css/'$component_name's.css";
		$fileLink->addStyleSheet($styleLoc2);



		/**************************  PAGE MAKER  ****************************/
		//Script used to create a siteside page on arrival to components admin page

		//Requires a table that can create nested sets for the lft and rgt fields in the menu table
		//if it doesn"t run this
        JTable::addIncludePath(JPATH_COMPONENT . "/tables");
        //$JQMLink = JFactory::getDocument();

        $table = JTable::getInstance("nestedsets","Table");
        $table2 = JTable::getInstance("menumaker","Table");

		/************************  CHECK TEMPLATE  *************************/
		//gets template id to add to menu table record
		$desired_template_name = "'$template_name'";

        $templateId = $table->checkTemplateData($desired_template_name);
        //$JQMLink->addScriptDeclaration("alert(\"the template id is ". $templateId ."\");");
        if($templateId == "false")
        {
            $templateId = 0;
        }
        /************************  END TEMPLATE  *************************/

       /************************  CHECK COMPONENT  *************************/
        /*gets component id to add to menu table data - no need for parameters. the component it checks
		for should have same name as this component*/

        $componentId = $table->checkComponentData();
        //$JQMLink->addScriptDeclaration("alert(\"the extension id is ". $componentId ."\");");
        if($componentId == "false")
        {
            //i many need to create an error message here
            $componentId = 0;
        }
        /************************  END COMPONENT  *************************/


		/************************  CHECK MENU DATA  *************************/
        //for menu_types table
		//creates its own MAIN MENU
        $menuId = $table2->checkMenuData();
        //$JQMLink->addScriptDeclaration("alert(\"the menu id is ".$menuId."\");");

        //checks for table data and adds data
        //this should be done when the component is installed but if not.
        if($menuId == "false")
        {
            $mD = array("menutype" => "'$component_name'menu","title" => "'$component_name' Menu",
            "description" => "Private test menu for the private '$component_title'");
            $table2->getTableName("menu_types");
            $table2->save($mD);
           // $table->bind($mD);
            //$table->store();
            $menuId = $table2->checkMenuData();


            //$JQMLink->addScriptDeclaration("alert(\"the menu id is ".$menuId."\");");

        }//end if

        /************************  END CHECK MENU DATA  *************************/



		/************************  CHECK MENU ITEM DATA  *************************/
		/* !!!! THE MAIN EVENT !!!! */
		//This and the file above but mainly this is the true purpose of this section of code
		//creates a menu dynamically for this component which will result in a siteside page being available
		//creates a menu item for the new main menu

        $menuItemId = $table->checkMenuItemData();

       //$JQMLink->addScriptDeclaration("alert(\"the item id is ".$menuItemId."\");");

        //checks for table data and adds data
        if($menuItemId == "false")
        {
            $mID = array("title" => "'$official_title'","menutype" => "'$component_name'menu","alias" => "'$custom_path'",
            "path"=>"'$custom_path'","link" => "index.php?option='$cn_full'&view='$component_name's",
            "type" => "component","published" => "1", "parent_id" => "1", "level" => "1", "language" => "*",
            "access" => "1","template_style_id" => $templateId, "component_id" => $componentId);
            $table->getTableName("menu");
            //note the alias and path are both not only case sensitive but must be lower case.
            //It can be written in any case but joomla only correctly processes the alias" that are lower case for page views
            // I spent hours with this little detail

            //everything else is not needed ->save() does them all automagically
            //$table->bind($sd); //$table->store(); //$table->rebuild(); //$table->rebuildPath($menuItemId);

            $table->setLocation("1","last-child");
            $table->save($mID);

            //$menuItemId = $table->checkMenuItemData();


            //$JQMLink = JFactory::getDocument();
            //$JQMLink->addScriptDeclaration("alert(\"the item id is ".$menuItemId."\");");

        }//end if

        /************************  END CHECK MENU ITEM DATA  *************************/






    }//end display

    protected function addToolbar()
    {

        $canDo = '$cn_init'Helper::getActions(); //$canDo = FolioHelper::getActions();
        /*
          $can_str = var_export($canDo);
          //returns:
          // JObject::__set_state(array( "_errors" => array ( ), "core.admin" => true, "core.manage" => true, "core.create" => true,
          // "core.delete" => true, "core.edit" => true, "core.edit.state" => true, "core.edit.own" => true, ))
        */

        $bar = JToolBar::getInstance("toolbar");

        //may need a capital B as in JToolBarHelper
        $twitt =
        //JToolbarHelper::title(JText::_("COM_FOLIO_MANAGER_FOLIOS"), "");
        JToolbarHelper::title(JText::_("'$cn_full_caps'_TITLE_'$cn_caps'"), "");
        JToolbarHelper::addNew("'$component_name'.add");/*adds the "new" button to the folio screen*/ //"folio.add"

            if($canDo->get("core.edit"))
            {
                JToolbarHelper::editList("'$component_name'.edit"); //folio.edit - adds edit button
            }
            if($canDo->get("core.admin"))
            {
                JToolbarHelper::preferences("'$cn_full'"); //com_folio - adds option button
            }
            if($canDo->get("core.delete"))
            {
                JToolbarHelper::deleteList("","'$cn's.delete","JTOOLBAR_DELETE");//this controls what is written on the delete btn
            }
        }
    }' > "view.html.php"

mkdir "tmpl"
cd "tmpl"
echo "<!DOCTYPE html><title></title>" > "index.html"
echo '<?php
defined("_JEXEC") or die;

$listOrder = "";
$listDirn = "";
/*this is the file that shows up in the back end display after
choosing folio in the components drop down menu.*/
?>


<!-- <h1>What?</h1>
<textarea rows="20" cols"50" >
<?php

/*require_once JPATH_COMPONENT."/views/folios/view.html.php";
$mish = JViewLegacy::__toString();//still not sure what this class does
echo $mish; //returns {"id":null,"title":null,"alias":null}
*/
?>
</textarea>
<div style="width:200px; height:200px; border:1px solid red;">
<a href="tel:202-713-1314">202-713-1314</a>

</div> -->

<?php /* I think I can use this to block out the rest of this code. */?>
<!-- -->


<form action="<?php echo JRoute::_("index.php?option='$cn_full'&view='$cn's");/*option=com_folio&view=folios */ ?>"
 method="post" name="adminForm" id="adminForm" >
 <div id="j-main-container" class="span12">
     <div class="clearfix"></div>
     <table class="table table-striped" id="'$cn'List"><!--id="folioList" -->
         <thead>
             <tr>
                 <th width="10%" class="center"><!-- hidden-phone -->
                     <input type="checkbox" name="checkall-toggle" value=""
                     title="<?php echo JText::_("JGLOBAL_CHECK_ALL"); ?>"
                     onclick="Joomla.checkAll(this)" />
                 </th>
                 <th class="title menus_title" >
                     <?php echo JHtml::_("grid.sort", "JGLOBAL_TITLE", "a.title",
                     $listDirn, $listOrder); ?>
                 </th>
                 <th width="5%" class="nowrap center hidden-phone">
                     <?php echo JHtml::_("grid.sort", "JGRID_HEADING_ID", "a.id",
                     $listDirn, $listOrder); ?>
                 </th>
                 <th width="20%" class="nowrap center hidden-phone">
                     style
                 </th>
                 <th width="20%" class="nowrap center">
                     <?php echo JHtml::_("grid.sort", "'$cn_full_caps'_HEADING_POSITION", "b.position",
                     $listDirn, $listOrder); ?>
                 </th>
                 <th width="5%" class="nowrap center">
                     <?php echo JHtml::_("grid.sort", "JSTATUS", "b.published",
                     $listDirn, $listOrder); ?>
                 </th>
                 <th width="5%" class="nowrap hidden-phone">
                     <?php echo JHtml::_("grid.sort", "'$cn_full_caps'_HEADING_MODULEID", "a.module_id",
                     $listDirn, $listOrder); ?>
                 </th>
             </tr>
         </thead>
         <tbody>
             <?php foreach($this->items as $i => $item): ?>
             <tr class="row<?php echo $i % 2; ?>" id="row<?php echo $i ?>">
                 <td class="center "><!-- hidden-phone -->
                     <?php echo JHtml::_("grid.id", $i, $item->id); ?>
                 </td>
                 <td class="nowrap has-context menus_title">
                 <a href="<?php echo JUri::current() . "?option='$cn_full'&task"
                 . "='$cn'.edit&id=".(int) $item->id; /*"index.php?option=com_folio&task
                 =folio.edit&id="*/ ?>">
                     <?php echo $this->escape($item->title); ?>
                 </a>
                 </td>
                 <td class="center hidden-phone">
                 <?php echo (int) $item->id; ?>
                 </td>
                 <td class="center hidden-phone">
                     <?php
                         $option_obj = json_decode($item->options);
                         $menu_style = (isset($option_obj->menu_style)) ? $this->escape($option_obj->menu_style) : "";
                         echo $menu_style;
                     ?>
                 </td>
                 <!--<td class="center hidden-phone">
                 <?php //$position = (isset($option_obj->position)) ? $this->escape($option_obj->position) : ""; echo $position; ?>
                 </td>-->
                 <td class="center">
                 <span class="label label-info">
                 <?php echo $this->escape($item->position); ?>
                 </span>
                 </td>
                 <td class="center">
                 <?php echo JHtml::_("jgrid.published",$item->published,$i,"'$cn's.","","cb",
                 $item->publish_up,$item->publish_down); ?>
                 </td>

                 <td class="center hidden-phone" id="module_<?php echo $i ?>">
                 <?php echo (int) $item->module_id; ?>
                 </td>

             </tr>
             <input type="hidden" name="options" value="" />
             <?php endforeach; ?>
         </tbody>
     </table>

     <input type="hidden" name="task" value="" />
     <input type="hidden" name="boxchecked" value="0" />
     <input type="hidden" name="filter_order" value="<?php echo $listOrder; ?>" />
     <input type="hidden" name="filter_order_Dir" value="<?php echo $listDirn; ?>" />
     <?php echo JHtml::_("form.token"); ?>

</form>
</div>
<script>
prepEvents();
</script>
' > "default.php"
#backout tmpl & $component_name  & views
cd ../../..

mkdir "xfiles"
cd "xfiles"
echo "<!DOCTYPE html><title></title>" > "index.html"

mkdir "css"
cd "css"
echo "<!DOCTYPE html><title></title>" > "index.html"
echo '*{box-sizing:border-box;}

  /** admin side **/

  /*responsive menu and media breakpoints*/

  /*@media (min-width:800px) and (max-width:900px){
  .controls.btn_Cont {margin-left:380px !important;}
  }*/ /*works*/

  /*@media only screen and (min-width:800px) and (max-width:900px){
  .controls.btn_Cont {margin-left:380px !important;}
  }*/ /*works*/



  @media only screen and (min-width:320px) and (max-width:479px){

  }

  @media only screen and (min-width:480px) and (max-width:767px){

  }

  @media only screen and (min-width:768px) and (max-width:991px)
  {

  }

  @media only screen and (min-width:992px) and (max-width:1999px)
  {

  }

  #jform_position,#jform_suffix{height:29px;}

  *[class*="_MBCont"]{ height:auto;margin:auto;width:95%;}/*border:1px solid yellow;*//*box-sizing:border-box;*/
  *[class*="_icon_menu"]{ height:120px; border:1px solid #ccc; border-radius:10px 0 0 0;padding:3px;
  overflow-y:auto;width:70%;float:left;}



  /*group sample*/
  .col_btn_group0:hover, .col_btn_group0:focus, .col_btn_group0:active, .col_btn_group0.active,
  .col_btn_group0.disabled, .col_btn_group0[disabled]{
  background-image:none !important;}/*background-color:#828282 !important;*/


  /****************** special IUN assignemnts ************************/
  /*image sample*/
  .jqm_icon_delete{background: url("../images/jqm_delete.png");}
  .jqm_icon_action{background: url("../images/jqm_action.png");}

  /* for temporary test classes */
  .test_yellow{border:1px solid yellow !important;}
  .test_red{border:1px solid red !important;}
  .test_blue{border:1px solid blue !important;}
  .test_green{border:1px solid green !important;}
  .test_purple{border:1px solid purple !important;}
  .test_orange{border:1px solid orange !important;}' > $component_name".css"
echo '*{box-sizing:border-box;}

  /** admin '$component_name' side **/

  .menus_title{width:20% !important;}

  @media only screen and (min-width:320px) and (max-width:479px){

  }




  @media only screen and (min-width:480px) and (max-width:767px){

  }




  @media only screen and (min-width:768px) and (max-width:991px)
  {

  }




  @media only screen and (min-width:992px) and (max-width:1999px)
  {

  }


  .jqm_icon_delete{background: url("../images/jqm_delete.png");}
  .jqm_icon_action{background: url("../images/jqm_action.png");}


  .test_yellow{border:1px solid yellow !important;}
  .test_red{border:1px solid red !important;}
  .test_blue{border:1px solid blue !important;}
  .test_green{border:1px solid green !important;}
  .test_purple{border:1px solid purple !important;}
  .test_orange{border:1px solid orange !important;}' > $component_name"s.css"
#backout xfiles
cd ..

mkdir "images"
cd "images"
echo "<!DOCTYPE html><title></title>" > "index.html"
#backout xfiles
cd ..

mkdir "js"
cd "js"
echo "<!DOCTYPE html><title></title>" > "index.html"
echo '
    //alert("pmod.js running!");
    console.log("pmod.js running!");

    dataObject = [{}];//the key to the object array is its initiation
    //I can not splice out the data and indexes shift without error
    optionObject = {};
    moduleData = {};

    function prepModuleEvents()
    {//"testBut"
        var saveBtn = document.getElementById("toolbar-save");

        saveBtn.firstElementChild.onclick = function(){
          //console.log(Joomla);
          //made sure it doesn"t save & redirect right away
          //try promises next time
           Joomla.submitbutton("'$cn'.apply");
           saveModule()/**/;}

        //development test button section
        //var saveBtn2 = document.getElementById("testBut");
        //saveBtn2.onclick = saveModule;
        //

        var titleArea = document.getElementById("jform_title");
        titleArea.onblur = uniqueCheck;

        //ids auto given to joomla input on edit page
        var menu_id = document.getElementById("jform_id").value;
        var module_id = document.getElementById("jform_module_id").value;
        var position = document.getElementById("jform_position");



        if(menu_id != 0 && module_id != 0)
        {
            //position.value = "custom_panel";//sets a default setting just in case
      //not needed. at least not anymore.
            getModuleData(module_id);
      //prepSaveModule(); //needs to run in ajax success function


        }//end if
        else
        {
            position.value = "custom_panel";
            //why wouldn"t i run it here.  why wait for a user initiated action
            prepSaveModule();
        }

        //for the failed module save
        if(menu_id != 0 && module_id == 0){

            /*notice: there are times when the ajax goes faster than expected and
            tries to save the module before the menu gets to save and there is no menu
            reference for the module so it all comes back false. then the menu saves
            this section is written to detect this occurance and resubmit the module save*/

            var alertBox = document.getElementsByClassName("alert-success")[0];
            alertBox.className = "alert alert-warning";
            alertMsg = document.getElementsByClassName("alert-message")[0];
            alertMsg.innerHTML = "one moment while module is still saving... </br> you may need to reconfigure your module position and module config data.";
            prepSaveModule();//it has to be down below the area where the position.value is still being configured
            saveModule();//happens on a new refreshed page with a newly saved menu but no module data saved

        }//end if

        /*alert("pathname = " + window.location.pathname + " \n " + " hostname = " + window.location.hostname
        + " \n " + " protocol = " + window.location.protocol + " \n " + " SITEURL = " + SITEURL);*/

    }//end prepModuleEvents

    function uniqueCheck()
    {
        //data:{title:titleValue} works
        //method:"POST" or type:"POST" works

        //alert("uniqueCheck running");
        var titleArea = document.getElementById("jform_title");
        var titleValue = titleArea.value;
        var titleMsg = document.getElementById("titleMsg");
        var ctrlrUrl = "index.php?format=raw&option='$cn_full'&task=uCheck";
        var saveBtn = document.getElementById("toolbar-save");
        var idCont = document.getElementById("jform_id");
        var idValue = idCont.value;

        //can i automatically disable until check is finished?
        //saveBtn.firstElementChild.setAttribute("disabled","true");

        jQuery(document).ready(function()
        {
           jQuery.ajax(
           {
            url:ctrlrUrl,data:"title=" + titleValue,type:"POST",
               success:function(result)
               {
                   //alert(result + " will return");
                   if(result != "false")
                   {
                    //alert("result is not false");
                    //disable the save button
                        if(result != idValue)
                        {
                        saveBtn.firstElementChild.setAttribute("disabled","true");
                        //fill the message
                        titleMsg.innerText = "Please choose another title."
                        titleMsg.style.display = "inline-block";
                        }//end if
                        else
                        {
                            /*removes the disabled if name is already chosen and you try to return
                            to the originally saved name */
                             //enable the save button
                            saveBtn.firstElementChild.removeAttribute("disabled");
                            //hide the message
                            titleMsg.style.display = "none";
                            //when name is ok to use
                            prepSaveModule();//I still need it to update here with title change
                        }

                    }else
                    {
                        //enable the save button
                        saveBtn.firstElementChild.removeAttribute("disabled");
                        //hide the message
                        titleMsg.style.display = "none";
                        //when name is ok to use
                        prepSaveModule();

                    }//end else


                }//end success

            })//end ajax

        })//end ready

    }//end uniqueCheck

    function prepSaveModule()
    {
        var title = document.getElementById("jform_title").value;
        var id = document.getElementById("jform_id").value;
        var access = getSelectedText("access","value");
        var status = getSelectedText("status","value");
        var position = document.getElementById("jform_position").value;



          moduleData = {"menu_title":title,"menu_id":id,"access":access,"status":status,"position":position};

    }//end prepSaveModule

    function saveModule()
    {
        //alert("save module running");

        if(moduleData.menu_title == ""){return;}

        var testUrl = "index.php?format=raw&option='$cn_full'&task=saveModule";
        if(moduleData.data_string != undefined){delete moduleData.data_string;}//removes data_string loop}

        var moduleStr = JSON.stringify(moduleData);//not working as a json str
        moduleData.data_string = moduleStr;
        //alert("POST data string = " + moduleData.data_string);
        //I can send entire objects as data and it will be parsed and available in $_POST[""]
        jQuery(document).ready(function()
        {
            jQuery.ajax(
            {
             url:testUrl,
             data:moduleData,
             type:"POST",
                success:function(result)
                {
                    //alert(result + "has returned");
                    console.log("ajax results = " + result);

                    var resultData = JSON.parse(result);

                    if(resultData.module_id != "false")
                    {
                        if(document.getElementsByClassName("alert-warning")[0])
                        {
                            var alertBox = document.getElementsByClassName("alert-warning")[0];
                             alertBox.className = "alert alert-success";
                             alertMsg = document.getElementsByClassName("alert-message")[0];
                             alertMsg.innerHTML = "module saved successfully";
                         }//end if

                         //without this the save is successful but the page refresh ends in a sloppy redirect with an error.
                         window.location.replace(SITEURL + "?option='$cn_full'&view='$cn's");
                    }//end if



                 }//end success

             });//end ajax
         });//end document ready

     }//end saveModule

     function getSelectedText(fNm,mod,inpt)
     {
         //takes id'"'"'s no need for the "jform_" prefix just add the field'"'"'s name
         //example "access" for "jform_access"
         //ex: getSelectedText("access","value");

         //other examples
         //var accessIndex = getSelectedText("access","match",resObj.access);
         //var statusIndex = getSelectedText("status","match",resObj.published);

         var objId = "jform_" + fNm;//fieldName
         var input_cont = document.getElementById(objId);
         var modifier = mod || "text";//defaults to text
         var returnData = "";
         var dEntry = inpt || "";

        switch(modifier){
         case "index":
             var selected_index = input_cont.selectedIndex;
             returnData = selected_index;
         break;
         case "value":
             var indexObj = input_cont[input_cont.selectedIndex];
             var  selected_text = indexObj.value;//
             returnData = selected_text;
         break;
         case "match":

             if(isNaN(dEntry) == true)
             {
                 //alert("string is not a number");
                 for(var i=0; i < input_cont.childElementCount; i++)
                 {
                     var indexObj = input_cont[i];
                     if(dEntry == indexObj.innerHTML)
                     {
                         returnData = i;//returns the index number of a given value
                     }
                 }//end for

             }
             else
             {
                for(var i=0; i < input_cont.childElementCount; i++)
                 {
                     var indexObj = input_cont[i];
                     if(dEntry == indexObj.value)
                     {
                         returnData = i;//returns the index number of a given value
                     }
                 }//end for
             }

         break;
         default:
             var indexObj = input_cont[input_cont.selectedIndex]
             var  selected_text = indexObj.innerHTML;//
             returnData = selected_text;
         break;
        }//end switch


         return returnData;
     }//end getSelectedText

     function getModuleData(mID)
     {
        var module_id = document.getElementById("jform_module_id").value;
        var ctrl_Url = "index.php?format=raw&option='$cn_full'&task=getModuleData";

        jQuery(document).ready(function()
        {
            jQuery.ajax(
            {
             url:ctrl_Url,
             data:{module_id:module_id},
             type:"POST",
                success:function(result)
                {
                    //alert("module data = " + result);//string
                    //break it up
                     var resObj = JSON.parse(result);
                     //put it where it belongs
                     var accessForm = document.getElementById("jform_access");
                     var statusForm = document.getElementById("jform_status");
                     var accessIndex = getSelectedText("access","match",resObj.access);
                     var statusIndex = getSelectedText("status","match",resObj.published);
                     accessForm.selectedIndex = accessIndex;
                     statusForm.selectedIndex = statusIndex;
          //alert("ajax position is " + resObj.position);
                     document.getElementById("jform_position").value = resObj.position;
          //data needs to be loaded into the data storage location
                    prepSaveModule();
                 }

             })
         })//end ajax


     }//end getModuleData

    function '$component_name'SampleAjax(obj)
    {
        var resultStr = "";

        var title = " some title ";
        //formerly  '$component_name'
        var urlStr = "index.php?format=raw&option='$cn_full'&task=getFakeData";
		//finds admin side components controller.php

           jQuery.ajax(
           {
            url:urlStr,
            data:"title=" + title,
            type:"POST",
               success:function(result)
               {
                   if(result == "false"){return;}
                   //alert("test " + result + " has returned ");
                   resultStr = result;



                }

            })


        return resultStr;

    }//end getURLString



    ' > $component_name".js"
echo '//alert("'$component_name' running!")


    function '$component_name'SampleAjax2()
    {
        var testUrl = "index.php?format=raw&option='$cn_full'&task=getFakeData";
        var tStr = " this with an s "
        //alert("checked ids = " + module_data.id_str + "\n module number is " + module_data.module_number);

        jQuery(document).ready(function()
        {
            jQuery.ajax(
            {
                url:testUrl,
                data:{"title": tStr},
                type:"POST",
                success:function(result)
                {
                   //alert("test " + result + " has returned");

                }

            })
        });//end jQ(doc

    }//end '$component_name'SampleAjax2

    //used for admin list view
    function prepEvents()
    {
        //alert("new script running!");
        var deleteBtn = document.getElementById("toolbar-delete");
        deleteBtn.firstElementChild.onclick = function()
        {
            if (document.adminForm.boxchecked.value==0)
            {
                alert("What Please first make a selection from the list.");
            }
            else
            {
                deleteModule();
                //Joomla.submitbutton("'$cn's.delete")
            };
        }//end function

    }//end prepEvents

    module_data = {};
    function deleteModule()
    {
        var testUrl = "index.php?format=raw&option='$cn_full'&task=deleteModule";
        prepIdString();

        //alert("checked ids = " + module_data.id_str + "\n module number is " + module_data.module_number);

        jQuery(document).ready(function()
        {
            jQuery.ajax(
            {
                url:testUrl,
                data:module_data,
                type:"POST",
                success:function(result)
                {
                   //alert(result + " has returned");
                   Joomla.submitbutton("'$cn's.delete");

                }

            })
        });//end jQ(doc

    }//end deleteModule

    function prepIdString()
    {
        //used to prepare the delete id string
        var checkEl = document.adminForm["cid[]"];///boxchecked.value
            module_data = {};
            module_data.module_number = document.adminForm.boxchecked.value;
            module_data.id_str = "";

            for(var i=0; i < checkEl.length; i++)
            {
                if(checkEl[i].checked == true)
                {
                    mIdStr = "module_" + i;
                    module_El = document.getElementById(mIdStr)
                    if(module_data.id_str == "")
                    {
                        module_data.id_str = "" + parseInt(module_El.innerHTML) + "";
                    }
                    else
                    {
                        module_data.id_str += "," + parseInt(module_El.innerHTML)  + "";
                    }//end else

                }//end if
            }//end for
        }//end prepIdString

    '> $component_name"s.js"
#backout js, xfiles & admin
cd ../..

echo "<!DOCTYPE html><title></title>" > "index.html"
echo '<?xml version="1.0" encoding="utf-8"?>
<access component="'$component_name'"><!-- component="com_folio">   -->
    <section name="component">
        <action name="core.admin" title="JACTION_ADMIN" description="JACTION_ADMIN_COMPONENT_DESC" />
        <action name="core.manage" title="JACTION_MANAGE" description="JACTION_MANAGE_COMPONENT_DESC" />
        <action name="core.create" title="JACTION_CREATE" description="JACTION_CREATE_COMPONENT_DESC" />
        <action name="core.delete" title="JACTION_DELETE" description="JACTION_DELETE_COMPONENT_DESC" />
        <action name="core.edit" title="JACTION_EDIT" description="JACTION_EDIT_COMPONENT_DESC" />
        <action name="core.edit.state" title="JACTION_EDITSTATE" description="JACTION_EDITSTATE_COMPONENT_DESC" />
        <action name="core.edit.own" title="JACTION_EDITOWN" description="JACTION_EDITOWN_COMPONENT_DESC" />
    </section>
</access>' > "access.xml"
echo '<?xml version="1.0" encoding="utf-8"?>
<config>
    <fieldset name="component" label="'$cn_full_caps'_COMPONENT_LABEL" description="'$cn_full_caps'_COMPONENT_DESC"></fieldset>
    <fieldset name="permissions" description="JCONFIG_PERMISSIONS_DESC" label="JCONFIG_PERMISSIONS_LABEL">
        <field name="rules" type="rules" component="'$cn'" filter="rules" validate="rules" label="JCONFIG_PERMISSIONS_LABEL" section="component" />
    </fieldset>
</config>' > "config.xml"
echo '<?php
defined("_JEXEC") OR die;/*stops page from being accessed directly*/

/*class for the controller. component name folled my controller*/

/*Creating the controllers
b.Loc 1921
*/

class '$cn_init'Controller extends JControllerLegacy
{
    //FolioController extends JControllerLegacy
    protected $default_view = "'$cn's";//folios

    public function display($cachable = false, $urlparams = false)
    {require_once JPATH_COMPONENT."/helpers/'$cn'.php";//folio

    $view = $this->input->get("view","'$cn's");//folios
    $layout = $this->input->get("layout","default");

     $id = $this->input->getInt("id");

      if($view == "'$cn'" && $layout == "edit" &&  !$this->checkEditId("'$cn_full'.edit.'$cn'", $id))//com_folio.edit.folio"
      {//$view == "folio"
          $this->setError(JText::sprintf("JLIB_APPLICATION_ERROR_UNHELD_ID",$id));
          $this->setMessage($this->getError(),"error");
          $this->setRedirect(JRoute::_("index.php?option='$cn_full'&review='$cn's", false));//?option=com_folio  &review=folios"

          return false;
          }

          parent::display();

          return $this;
        }

        function uCheck()
        {
          //checks to see if the title is unique
            $targTitle = $_POST["title"];
            JTable::addIncludePath(JPATH_COMPONENT . "/tables");
            $table = JTable::getInstance("menumaker","Table");
            $menuId = $table->checkMenuTitle($targTitle);

            echo $menuId;//this works though

        }//end workit

        function saveModule()
        {
            JTable::addIncludePath(JPATH_COMPONENT . "/tables");
            $table = JTable::getInstance("moduleassets","Table");

            $menu_title = $_POST["menu_title"];
            $menu_id = $_POST["menu_id"];
            $dataStr = $_POST["data_string"];

            /*if($menu_id == 0)
            {
                $result = $table->preSaveMenu($dataStr);
            }*/


            //check for existence of module - can be used if the menu saves and the module doesn"t
            //this checker is to make sure the absent module_id wasn"t due only to an error

            //aleady has a module
            $module_id = $table->getModuleId($menu_id);//what if there is a menu_id of 0?

            $init_id = "initial menu id = " . $menu_id;//initial id = false
            $init_mod = "initial module id = " . $module_id;//initial id = false
            $init_data = "initial data = " . $dataStr;

            if($module_id == "false")
            {
                //does not have a module id
                $menu_id = $table->saveNewModule($dataStr);

                if($menu_id != "false")
                {
                    //has a menu id
                    $module_id = $table->getModuleId($menu_id);
                }//end if
            }//end if

            if($menu_id != "false" && $module_id != "false")
            {//has a menu id & has a module id

                //save new asset to asset table
                $name_str = "com_modules.module." . $module_id;
                $asset_id = $table->getAssetId($name_str);
                if($asset_id == "false" && $module_id != "false")
                {
                    //has a module id does not have an asset id

                    $mID = array("parent_id" => "18","level" => "2","name" => $name_str,
                    "title" => $menu_title,
                    '"'"'rules'"'"' => '"'"'{"core.delete":{"6":1},"core.edit":{"6":1,"4":1},"core.edit.state":{"6":1,"5":1},"module.edit.frontend":[]}'"'"'
                    );
                    $table->getTableName("assets");
                    $table->setLocation("18","last-child");//i don"t remember what this does
                    $table->save($mID);

                    //get asset_id
                    $asset_id = $table->getAssetId($name_str);

                     //save module_id in '$cn' table
                    if($asset_id != "false" && $module_id != "false")
                    {
                        $updateMsg = $table->updateTables($asset_id,$module_id,$menu_id,$dataStr);//8 124 67

                    }//end if
                }//end if asset_id


                if($asset_id != "false" && $module_id != "false")
                {
                    $updateModMsg = $table->updateModule($module_id,$menu_id,$dataStr);//8 124 67

                }//end if

                $mod_menu = $table->checkModMenu($module_id);
                if($mod_menu == "false")
                {
                    //just in case they were accidentally removed - reset to all pages.
                    //$mod_menu = $table->updateModMenu($module_id);
                }//end if


            }
                echo '"'"'{"menu_id":"'"'"' . $menu_id . '"'"'","module_id":"'"'"' . $module_id . '"'"'"}'"'"' ;//this works
                //echo '"'"'{"menu_id":"" . $menu_id . "","module_id":"" . $module_id . "","init_mod":"" . $init_mod . "","init_data":"" . $init_data . "","init_id":"".$init_id.""}'"'"' ;//test area

                return;
                //the below json code doesn"t parse correctly double quotes are better for the object parameters
                //echo '"'"'{"menu_id":"" . $menu_id . "","module_id":"" . $module_id . ""}'"'"' ;
                //echo $menu_id;

        }//end saveModule

        function getModuleData()
        {

            JTable::addIncludePath(JPATH_COMPONENT . "/tables");
            $table = JTable::getInstance("moduleassets","Table");


            $module_id = $_POST["module_id"];

            $moduledata = $table->getModuleData($module_id);

            echo $moduledata;


        }//end getModuleData

        function deleteModule()
        {
            JTable::addIncludePath(JPATH_COMPONENT . "/tables");
            $table = JTable::getInstance("moduleassets","Table");
            //echo "module string = " . $_POST["id_str"];
            //echo "\n module number is " . $_POST["module_number"];

            $module_number = $_POST["module_number"];

            if($module_number == "1")
            {
                $module[0] = $_POST["id_str"];
            }
            else
            {
                $module = explode(",",$_POST["id_str"]);
            }

            $delete_results = $table->deleteElements($module);

            echo "results are in " . $delete_results;

        }//end deleteModule

        function getUrls()
        {
            JTable::addIncludePath(JPATH_COMPONENT . "/tables");
            $table = JTable::getInstance("moduleassets","Table");

            $title = $_POST["title"];
            $menuStr = $table->getUrls($title);

            echo $menuStr;

        }

		function getFakeData()
        {
            //the alert below does nothing because im not actually on this page when i call this function through ajax
            //$JQMLink = JFactory::getDocument();
            //$JQMLink->addScriptDeclaration("alert(\" work it is working \");");

			//targets the table in the tables directory
			JSession::checkToken( "get" ) or die( "Invalid Token" );
			/*
			//	window["FORM_TOKEN"] = "<?php //echo JHtml::_("form.token"); ?>";

				//this one works
				window["FORM_TOKEN"] = "<?php echo JSession::getFormToken(); ?>";
			*/

            $targTitle = $_POST["title"];

            echo " returned title is " . $targTitle;//this works though

        }//end workit





}' > "controller.php"
echo '<?php
defined("_JEXEC") or die;

if(!JFactory::getUser()->authorise("core.manage","'$cn_full'"))//com_folio
{
    return JError::raiseWarning(404, JText::_("JERROR_ALERTNOAUTHOR"));
}

$controller = JControllerLegacy::getInstance("'$cn_init'");//Folio
$controller->execute(JFactory::getApplication()->input->get("task"));
$controller->redirect();' > $cn".php"
echo '<?xml version="1.0" encoding="utf-8"?>
<extension type="component" version="3.0" method="upgrade">
    <name>'$cn_full'</name><!-- com_folio  -->
    <author>'$authors_name'</author>
    <creationDate>'$my_month_year'</creationDate>
    <copyright>(c) '$my_year' '$company_name' llc. All rights reserved.</copyright>
    <authorEmail>'$display_email'</authorEmail>
    <authorUrl>'$display_url'</authorUrl>
    <version>1.0.0</version>
    <description>'$cn_full_caps'_XML_DESCRIPTION</description><!-- COM_FOLIO_XML_DESCRIPTION  -->
    <scriptfile>script.php</scriptfile>
    <install>
        <sql>
            <file driver="mysql" charset="utf8">sql/install.mysql.utf8.sql</file>
        </sql>
    </install>
    <uninstall>
        <sql>
            <file driver="mysql" charset="utf8">sql/uninstall.mysql.utf8.sql</file>
        </sql>
    </uninstall>

    <files folder="site">
            <filename>index.html</filename>
            <filename>controller.php</filename>
            <filename>'$cn'.php</filename><!-- folio.php  -->
            <folder>controllers</folder>
            <folder>language</folder>
            <folder>models</folder>
            <folder>views</folder>
    </files>
    <languages folder="site">
        <language tag="en-GB">language/en-GB/en-GB.'$cn_full'.ini</language><!-- en-GB.com_folio.ini  -->
    </languages>
    <administration>
        <menu img="class:categories">'$cn_full_caps'_MENU</menu><!-- COM_FOLIO_MENU i dont think this one is even used -->
        <files folder="admin">
           <filename>index.html</filename>
           <filename>access.xml</filename>
           <filename>config.xml</filename>
           <filename>controller.php</filename>
           <filename>'$cn'.php</filename><!-- folio.php  -->
           <folder>controllers</folder>
           <folder>helpers</folder>
           <folder>models</folder>
           <folder>sql</folder>
           <folder>tables</folder>
           <folder>views</folder>
        </files>
        <languages folder="admin">
        <language tag="en-GB">language/en-GB/en-GB.'$cn_full'.ini</language><!-- en-GB.com_folio.ini  -->
        <language tag="en-GB">language/en-GB/en-GB.'$cn_full'.sys.ini</language><!-- en-GB.com_folio.sys.ini  -->
        </languages>
    </administration>
    </extension>' > $cn".xml"
echo '<?php

defined("_JEXEC") or die;

class '$cn_full'InstallerScript /*com_folioInstallerScript*/
{
    function install($parent)
    {
        //JFactory::getDocument()->addScriptDeclaration("alert(" parent is ".$parent."")");
        $parent->getParent()->setRedirectURL("index.php?option='$cn_full'");
    }

    function uninstall($parent)
    {
        echo "<p>" . JText::_("'$cn_full_caps'_UNINSTALL_TEXT") . "</P>";
    }

    function update($parent)
    {
        echo "<p>" . JText::_("'$cn_full_caps'_UPDATE_TEXT") . "</P>";
    }

    function preflight($type, $parent)
    {
        echo "<p>" . JText::_("'$cn_full_caps'_PREFLIGHT_" . $type . "_TEXT") . "</P>";
    }

    function postflight($type, $parent)
    {
        echo "<p>" . JText::_("'$cn_full_caps'_POSTFLIGHT_" . $type . "_TEXT") . "</P>";
    }
}' > "script.php"

#back out of admin
cd ..
#ADMIN SECTION END
#####################################    SITE SECTION     #############################################
#SITE SECTION START
mkdir "site"
cd "site"
echo "<!DOCTYPE html><title></title>" > "index.html"

mkdir "controllers"
cd "controllers"
echo "<!DOCTYPE html><title></title>" > "index.html"
echo '<?php
defined("_JEXEC") or die;
class '$cn_init'ControllerD3templates extends JControllerForm //class FolioControllerFolios
{
}' > $cn"s.php"
cd ..
mkdir "language"
cd "language"
echo "<!DOCTYPE html><title></title>" > "index.html"

mkdir "en-GB"
cd "en-GB"
echo "<!DOCTYPE html><title></title>" > "index.html"
echo ''$cn_full_caps'_COMPANY = "Company: "
'$cn_full_caps'_PHONE = "Phone: "' > "en-GB."$cn_full".ini"
#back out en-GB & language
cd ../..

mkdir "models"
cd "models"
echo "<!DOCTYPE html><title></title>" > "index.html"
echo '<?php
defined("_JEXEC") or die;

class '$cn_init'Model'$cn_init's extends  JModelList //FolioModelFolios extends  JModelList
{
    public function __construct($config = array())
    {
        if(empty($config["filter_fields"]))
        {
            $config["filter_fields"] = array(
                                                "id", "a.id",
                                                "title", "a.title" );


        }

        parent::__construct($config);
    }

    protected function getListQuery()
    {
        $db = $this->getDbo();
        $query = $db->getQuery(true);

        $query->select(
            $this->getState(
                "list.select",
                "a.id, a.title") );

        $query->from($db->quoteName("#__'$cn'")." AS a"); /*("#__folio")." AS a"*/

        return $query;

    }

}' > $cn"s.pphp"
#back ouit of models
cd ..

mkdir "tables"
cd "tables"
echo "<!DOCTYPE html><title></title>" > "index.html"
echo '<?php
defined("_JEXEC") or die;

class Table'$cn' extends JTableNested
{

    public function __construct($db)
    {
        parent::__construct("#__'$cn'","id",$db);
    }

    public function getMenuData($moId)
    {

        $db = jFactory::getDbo();
        $query = $db->getQuery(true);
        $query->select($db->quoteName(array("id","title","data","options")));
        $query->from($db->quoteName("#__'$cn'"));
        $query->where($db->quoteName("module_id") . " LIKE ". $db->quote($moId));//'$cn' Test Page
        $db->setQuery($query);

        $menuData = json_encode($db->loadObject());
        return $menuData;


    }//end getMenuData

	public function getFakeData($moId)
	{
		//run some $db query
		//return something;
		return "absolutely nothing!";

	}

}//end class
' > "'$cn'.php"
#table names can be anything as long as they match in the controller and in the tables class
#back out of tables
cd ..

mkdir "views"
cd "views"
echo "<!DOCTYPE html><title></title>" > "index.html"

mkdir $cn"s"
cd $cn"s"
echo "<!DOCTYPE html><title></title>" > "index.html"
echo '<?php
defined("_JEXEC") or die;

class '$cn_init'View'$cn_init's extends JViewLegacy //class FolioViewFolios
{
    protected $items;

    public function display($tpl = null)
    {
        $this->items = $this->get("Items");

        if(count($errors = $this->get("Errors")))
        {
            JError::raiseError(500, implode("\n", $errors));
            return false;
        }

        //samples for connecting
        //works to add icons to mobile web app.
        /*$myDoc3 = JFactory::getDocument();
        $href1 = "/mirror/images/flame2x.png";
        $attribs1 = array("sizes" => "128x128");
        $myDoc3->addHeadLink( $href1, "shortcut icon", "rel", $attribs1 );*/

        /****** This code checks for an internet connection  *******/
        $connected = @fsockopen("www.google.com",80);
        if($connected)
        {
          $is_conn = true;
          fclose($connected);
        }else
        {
          $is_conn = false;
        }
        /****************** end connection checker  ****************/


        //turn off the address bar for mobile web apps
        /*$myDoc1 = JFactory::getDocument();
        $myDoc1->setMetaData( "mobile-web-app-capable", "yes" );

        $myDoc2 = JFactory::getDocument();
        $myDoc2->setMetaData( "apple-mobile-web-app-capable", "yes" );*/

        //for best results delete templates favicon
        $myDoc5 = JFactory::getDocument();
        $href3 = "/mirror/images/favicon2.ico";
        $rel3 = "shortcut icon";
        $type3 = "image/vnd.microsoft.icon";
        $myDoc5->addFavicon($href3,$type3, $rel3);

        //$myDoc6 = new JDocumentHtml;
        //$myDoc6->addFavicon($href3,$type3);

        //sets document title override
        $myDoc6 = JFactory::getDocument();
        //$myTitle1 = array();
        $myDoc5->setHeadData(["title" => "'$official_title'"]);//$myTitle1


		$fileLink = JFactory::getDocument();

		$styleLoc = JUri::base() . "components/'$cn_full'/xfiles/css/'$cn'_site.css";
        $fileLink->addStyleSheet($styleLoc);

		$scriptLoc = JUri::base() . "components/'$cn_full'/xfiles/js/'$cn'_site.js";
        $fileLink->addScript($scriptLoc);


        parent::display($tpl);


    }

}
' > "view.html.php"

mkdir "tmpl"
cd "tmpl"
echo "<!DOCTYPE html><title></title>" > "index.html"
echo '<?php
defined("_JEXEC") or die;
?>
<div id="popup_holder" class="popup_holder" >

</div><!-- href="#d3_popup" -->
<a class="d3_cnxs test_yellow ui-btn ui-corner-all"  data-rel="popup" data-position-to="window" data-transition="pop" onclick="$(\"#d3_popup\").popup();$(\"#d3_popup\").popup(\"open\");
">Link</a>
<div class="d3_communities"  ></div>
<script>
window["SITEURL"] = "<?php echo JUri::current(); ?>";
//console.info("site url = " + SITEURL);//

window["FORM_TOKEN"] = "<?php echo JSession::getFormToken(); ?>";
//getFakeArcData("123");
//arc_setTheStage();

/****** This code checks for an internet connection  *******/
window["CNX_STATUS"] = "<?php
  $connected = @fsockopen(\"www.google.com\",80);

  if($connected)
  {
    //$is_conn = true;
    $is_conn = "online";
    fclose($connected);
  }else
  {
    //$is_conn = false;
    $is_conn = "offline";
  }
   echo $is_conn;
?>";
/****************** end connection checker  ****************/

window["IMG_URL"] = "<?php echo JUri::root(); ?>components/com_arc/xfiles/images/";

//window["HOME_URL"] =  "<?php echo JUri::root(); ?>index.php/'$cn'/home";//see view.html.php
//console.info("home url = " + HOME_URL);

screen.orientation.lock("portrait-primary").catch(function(){});

//this removes all the endless hashs added to the address to make an extremely lengthly url
location.hash = "";
//getFakeArcData("123");
d3_create_panel({"home":"popup_holder","panel_name":"d3_panel","popup_name":"d3_popup"});
</script>
' > "default.php"
echo '<?xml version="1.0" encoding="utf-8" ?>
<metadata>
    <layout title="'$cn_full'_'$cn's_view_default_title"
    option="'$cn_full'_'$cn's_view_default_option">
    <!-- language strings found in admin sys.ini file -->
        <message>
            <![CDATA['$cn_full'_'$cn's_view_default_desc]]>
        </message>
    </layout>
</metadata>
' > "default.xml"
#back out of tmpl $cn & views
cd ../../..

mkdir "xfiles"
cd "xfiles"
echo "<!DOCTYPE html><title></title>" > "index.html"

mkdir "css"
cd "css"
echo "<!DOCTYPE html><title></title>" > "index.html"
echo '*{box-sizing:border-box;}

/** SiteSide **/
.d3_cnxs{height:50px; width:100%;}
.d3_popup{width:90%;}
#d3_popup-popup{width:90% !important;}
.d3_panel_main_content{height:300px;}
.d3_panel_infoBox{height:20px;margin-bottom:0px;}
.d3_panel_infoBtn{float:right;margin:0px;right:-8px;}
.d3_panel_infoCont{margin-bottom: 10px;}
.d3_info_close_btn{float:right; position:relative !important; top:-30px !important; right:-7px !important;margin:0px !important;}
.d3_infoBox{display:none;}
.main_d3_info{border: 1px solid #ddd; padding: 0px 10px;}


@media only screen and (min-width:320px) and (max-width:479px){

}

@media only screen and (min-width:480px) and (max-width:767px){

}

@media only screen and (min-width:768px) and (max-width:991px)
{

}

@media only screen and (min-width:992px) and (max-width:1999px)
{

}

/***************** test rules **********************/
.test_yellow{border:1px solid yellow !important;}
.test_red{border:1px solid red !important;}
.test_blue{border:1px solid blue !important;}
.test_green{border:1px solid green !important;}
.test_purple{border:1px solid purple !important;}
.test_orange{border:1px solid orange !important;}
/***************** test rules **********************/

' > $cn"_site.css"
#back out of css
cd ..

mkdir "images"
cd "images"
echo "<!DOCTYPE html><title></title>" > "index.html"
#back out of images
cd ..

mkdir "js"
cd "js"
echo "<!DOCTYPE html><title></title>" > "index.html"
echo '//alert("d3 script running!");

	function d3_create_panel(obj)
	{
		//creates a popup panel
		var home = obj.home;
		var pop_name = obj.popup_name;
		var pan_name = obj.panel_name;

		var modal_target = (document.getElementById(home)) ? document.getElementById(home) : document.getElementsByClassName(home)[0];

			var d3_popup = document.createElement("div");
			d3_popup.id = "d3_popup";//pop_name
			d3_popup.className = "d3_popup";
			d3_popup.dataset.role = "popup";
			d3_popup.setAttribute("data-overlay-theme","b");
			d3_popup.dataset.theme = "a";
			d3_popup.setAttribute("data-dismissible","false");

				var d3_panel = document.createElement("div");
				d3_panel.id = "d3_panel";//pan_name
				d3_panel.dataset.role = "panel";
				d3_panel.dataset.position = "right";
				d3_panel.dataset.display = "overlay";
				d3_panel.dataset.theme = "a";
				d3_panel.setAttribute("data-position-fixed","false");
				d3_panel.setAttribute("data-dismissible","false");
				d3_panel.setAttribute("data-swipe-close","false");

					var d3_panel_close = document.createElement("a");
					d3_panel_close.id = "gps_panel_close"
					d3_panel_close.setAttribute("href","#");
					//d3_panel_close.onclick = alight_panel_reset;

					d3_panel_close.dataset.rel = "close";
					d3_panel_close.dataset.ajax = "false";
					d3_panel_close.className = "gps_panel_btn ui-btn ui-btn-right ui-btn-inline ui-shadow"
					+ " ui-corner-all ui-mini ui-icon-delete ui-btn-icon-right ui-btn-icon-notext";
					d3_panel_close.innerHTML = "cancel";


					var d3_panel_inner = document.createElement("div");
					d3_panel_inner.id="d3_innerPanel";
					d3_panel_inner.className = "ui-panel-inner";

				d3_panel.appendChild(d3_panel_close);
				//d3_panel.appendChild(d3_panel_refresh);//moved to prep_CoordViewer3()
				d3_panel.appendChild(d3_panel_inner);

			//d3_popup.appendChild(d3_panel);


		/*********************  The rest of the inner popup panel **********************/
		var pUS_closeBtn =  document.createElement("a");
				pUS_closeBtn.id = "pUS_closeBtn";
				pUS_closeBtn.setAttribute("href","#");
				pUS_closeBtn.dataset.rel = "back";
				pUS_closeBtn.className = "ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right";
				//pUS_closeBtn.onclick = user_reset;
				pUS_closeBtn.title = "cancel";
				pUS_closeBtn.innerHTML = "close";

				var d3_panel_main = document.createElement("div");
				d3_panel_main.id = "d3_panel_main";
				d3_panel_main.setAttribute("role","main");
				d3_panel_main.className = "ui-content ";

					var d3_panel_main_content = document.createElement("div");
					d3_panel_main_content.id = "d3_panel_main_content";
					d3_panel_main_content.className = "d3_panel_main_content ui-grid-a";

						//content area

					//d3_panel_main_content.appendChild();

					var d3_panel_infoBox = document.createElement("div");
					d3_panel_infoBox.id = "d3_panel_infoBox";
					d3_panel_infoBox.className = "d3_panel_infoBox";

						var d3_panel_infoBtn = document.createElement("div");
						d3_panel_infoBtn.id = "d3_panel_infoBtn";
						d3_panel_infoBtn.setAttribute("href","#");
						d3_panel_infoBtn.className = "d3_panel_infoBtn ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-info ui-btn-icon-notext";
						d3_panel_infoBtn.title = "help info";
						d3_panel_infoBtn.onclick = function(){d3_toggleDisplay({"id":"d3_infoBox"});d3_toggleDisplay({"id":"d3_panel_infoBtn"});};
						d3_panel_infoBtn.innerHTML = "info";
						d3_panel_infoBtn.style.display = "block";



					d3_panel_infoBox.appendChild(d3_panel_infoBtn);


					var d3_panel_infoCont = document.createElement("div");
					d3_panel_infoCont.id = "d3_panel_infoCont";
					d3_panel_infoCont.className = "d3_panel_infoCont";

						var d3_infoBox = document.createElement("div");
						d3_infoBox.id = "d3_infoBox";
						d3_infoBox.className = "d3_infoBox";
						d3_infoBox.style.display = "none";

							var d3_info_close_btn = document.createElement("a");
							d3_info_close_btn.id = "d3_info_close_btn";
							d3_info_close_btn.setAttribute("href","#");
							d3_info_close_btn.className = "d3_info_close_btn  ui-btn ui-corner-all ui-alt-icon ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right";
							d3_info_close_btn.onclick = function(){d3_toggleDisplay({"id":"d3_infoBox"});d3_toggleDisplay({"id":"d3_panel_infoBtn"});};

							var main_d3_info = document.createElement("div");
							main_d3_info.id = "main_d3_info";
							main_d3_info.className = "main_d3_info";
							main_d3_info.innerHTML = "<p>You dont have to be registered to start exchanging information. If you are a brand new user click the guest icon.</p>";

						d3_infoBox.appendChild(d3_info_close_btn);
						d3_infoBox.appendChild(main_d3_info);


					d3_panel_infoCont.appendChild(d3_infoBox);

				d3_panel_main.appendChild(d3_panel_main_content);
				d3_panel_main.appendChild(d3_panel_infoBox);
				d3_panel_main.appendChild(d3_panel_infoCont);

			d3_popup.appendChild(pUS_closeBtn);
			d3_popup.appendChild(d3_panel_main);


		modal_target.appendChild(d3_popup);

		//$("#d3_popup").popup();

	}//end d3_create_ui

	function d3_toggleDisplay(obj)
	{
		var disp_id = obj.id;
		var targ_el = (document.getElementById(disp_id)) ? document.getElementById(disp_id) : document.getElementsByClassName(disp_id)[0];

		targ_el.style.display = (targ_el.style.display == "none") ? "block" : "none";

	}//end d3_toggleDisplay

    function getFakeCnxData(mId)
    {
		//called from default in views > cnxs > tmpl > default
		//ajax calls getFakeData in cnx controller.php

        //alert("module id = " + mId);




			var uploadData = {};

			var form_token = FORM_TOKEN;


			var urlMod = "getFakeData";//put controller.php method call here

			var ctrl_Url = "index.php?option='$cn_full'&task=" + urlMod + "&format=raw&" + form_token + "=1";//this works



			$(document).ready(function()
			{
			   //alert("getMenuData running!");
			   $.ajax(
			   {

				url:ctrl_Url,
				/*data:{"userData":userData},*/
				data:uploadData,
				//data:userData,
				type:"POST",
				   success:function(result,textStatus,xhr)
				   {
					   console.log("scan textStatus = " + textStatus);
					   console.log("scan xhr  = " + xhr);
					   console.info("scan xhr status = " + xhr.status);

					   //alert("Ajax test result data = " + result);//string
						console.log("Ajax test result data = " + result);//string
						//var makeMenu = new menuMaker(result);
						//makeMenu.display();

						//if upload is successful

						//change the upload icon to successful
						//if(result.indexOf("invalid token") == -1)
						if(result != "Invalid Token")
						{
							if(result == "controller connection successful")
							{



							}
							else if(result.indexOf("<!doctype html>") == -1){
								//this comes up if the entire page"s html comes back in the request
								alert("Give me moment...  Resubmit your entry by  \n pressing the go button again.");

								//$.mobile.loading("hide");
							}
						}else
						{
								alert("Its not you... its me. \n Your session timer has expired. \n Please reset the page and give \n \"us\" a little more time.")

								window.location.replace(SITEURL);
						}

						//hide

					}

				})
			})//end ajax

    }//end getFakeCnxData
' > $cn"_site.js"
#back out of js & xfiles
cd ../..

echo '<?php
defined("_JEXEC") or die;

class '$cn'Controller extends JControllerLegacy //class folioController
{

		function testModule()
        {
			//targets the table in the tables directory
			JSession::checkToken( "get" ) or die( "Invalid Token" );
			/*
			//	window["FORM_TOKEN"] = "<?php //echo JHtml::_("form.token"); ?>";

				//this one works
				window["FORM_TOKEN"] = "<?php echo JSession::getFormToken(); ?>";
			*/

            echo "we are back too ";

        }//end testModule

		function getFakeData()
		{
			//called from '$cn'_site.js calls getFakeData in moduleassests.php in tables directory
			//targets the table in the tables directory

			//targets the table in the tables directory
			JSession::checkToken( "get" ) or die( "Invalid Token" );
			/*
			//	window["FORM_TOKEN"] = "<?php //echo JHtml::_("form.token"); ?>";

				//this one works
				window["FORM_TOKEN"] = "<?php echo JSession::getFormToken(); ?>";
			*/

			JTable::addIncludePath(JPATH_COMPONENT . "/tables");
			$table = JTable::getInstance("'$cn'","Table");
      //this represents the filename not the class inside the file.
      //but the names do have to be similar - if not exact i used bigTest & TableBigTest of  TablebigTest
      //table names can be anything as long as they match in the controller and in the tables class

			//$module_str = $_POST["module_str"];
      $jinput = JFactory::getApplication()->input;
      $module_str = $jinput->get("module_str");//this worked

			$menu_data = $table->getFakeData("pass anything or nothing");

			echo "controller connection successful";
			//echo " menu data = " . $menu_data . " & module string = " . $module_str;

		}

}' > "controller.php"
echo '<?php
defined("_JEXEC") or die;

$controller = JControllerLegacy::getInstance("'$cn_init'"); //getInstance("Folio");
$controller->execute(JFactory::getApplication()->input->get("task"));
$controller->redirect();

' > $cn".php"

#SITE SECTION END
#BACK OUT OF SITE AND COMPONENT
cd ../..

#make a zip folder
zip -r $cn_full"_v1.0.0.zip" $cn_full"_v1.0.0"

#/*****************************************************************************************************/
#/********   MODULE SECTION (module maker section) ******************************************************************/
#/*****************************************************************************************************/

mkdir "mod_"$module_name"_v1.0.0"
cd "mod_"$module_name"_v1.0.0"

mkdir language
#change to language directory
cd language
#make html placeholder
echo "<!DOCTYPE html><title></title>" > index.html
mkdir en-GB
#enter new dir
cd en-GB
echo $mn_full_caps'_FIELD_COUNT_LABEL="Count"
'$mn_full_caps'_FIELD_COUNT_DESC="The number of items to display (default is 5)"' > "en-GB."$mn_full".ini"
echo "<!DOCTYPE html><title></title>" > index.html

#back to main dir
cd ../..
mkdir tmpl
cd tmpl
echo "<!DOCTYPE html><title></title>" > index.html
echo '<?php defined("_JEXEC") or die ; ?>

<div class="'$module_name'<?php echo $moduleclass_sfx ?>"><!-- latestextensions -->
    <div class="row-striped">
    <?php foreach ($list as $item) : ?>
        <div class="row-fluid">
            <div class="span6">
                <strong class="row-title">
                    <?php echo $item->name; ?>
                </strong>
            </div>
            <div class="span3 hidden-phone">
                <?php echo $item->type; ?>
            </div>
            <div class="span3 hidden-tablet hidden-phone">
                <?php echo $item->id; ?>
            </div>
        </div>
    <?php endforeach; ?>
    </div>
</div>' > default.php

cd ../
mkdir xfiles
cd xfiles
echo "<!DOCTYPE html><title></title>" > index.html
mkdir css
cd css
echo "<!DOCTYPE html><title></title>" > index.html
echo '*{box-sizing:border-box;}


/*********************************/
@media(min-width: 55em){

}
/***************************/

@media only screen and (min-width:320px) and (max-width:479px){

}

@media only screen and (min-width:480px) and (max-width:767px){

}

@media only screen and (min-width:768px) and (max-width:991px)
{

}

@media only screen and (min-width:992px) and (max-width:1999px)
{

}


.word_wrap{
/* These are technically the same, but use both */
  overflow-wrap: break-word;
  word-wrap: break-word;

  -ms-word-break: break-all;
  /* This is the dangerous one in WebKit, as it breaks things wherever */
  word-break: break-all;
  /* Instead use this non-standard one: */
  word-break: break-word;

  /* Adds a hyphen where the word breaks, if supported (No Blink) */
  -ms-hyphens: auto;
  -moz-hyphens: auto;
  -webkit-hyphens: auto;
  hyphens: auto;
  }

  .ui-icon-wifi:after {
  background-image: url("../images/wifi.png");/* Make your icon fit */
  background-size: 18px 18px;
  }

  .clear,.clr{clear:both;}

  .d3-ui:after{content: "";
  height: 20px;
  width: 100%;
  display: block;
  background-repeat: no-repeat;
  background-position: center center;
  top: 10px;
  left: 0px;
  }


  .d3-btn:focus{
    outline:none;
    box-shadow: 0 0 12px #38c;
  }

/********************************************************************************/

/***************** test rules **********************/
.test_yellow{border:1px solid yellow !important;}
.test_red{border:1px solid red !important;}
.test_blue{border:1px solid blue !important;}
.test_green{border:1px solid green !important;}
.test_purple{border:1px solid purple !important;}
.test_orange{border:1px solid orange !important;}
/***************** test rules **********************/' > $module_name"_module.css"
cd ../

mkdir js
cd js
echo "<!DOCTYPE html><title></title>" > index.html
echo 'alert("'$module_name'.js is running");

var component_title = "com_'$component_name'";


    function testModule()
    {
        //this calls the controller.php on the admin side.  but the admin side is password protected.  I need the site
        //side controller.
        //var ctrl_Url = "administrator/index.php?option=com_'$component_name'&task=testModule&format=raw";//this works
        var ctrl_Url = "index.php?option=" + component_title + "&task=testModule&format=raw";//this works

        jQuery(document).ready(function()
        {
           alert("testAjax running!");
           jQuery.ajax(
           {

            url:ctrl_Url,
            data:{"test":"whatever"},
            type:"POST",
               success:function(result)
               {
                   alert("result data = " + result);//string


                }

            })
        })//end ajax


    }//end testModule

    function getMenuData(mId)
    {
        //alert("module id = " + mId);

        var ctrl_Url = "index.php?option=" + component_title + "&task=getMenuData&format=raw";//this works

        jQuery(document).ready(function()
        {
           //alert("getMenuData running!");
           jQuery.ajax(
           {

            url:ctrl_Url,
            data:{"module_id":mId},
            type:"POST",
               success:function(result)
               {
                   //alert("result data = " + result);//string

                    var makeMenu = new menuMaker(result);
                    makeMenu.display();

                }

            })
        })//end ajax

    }//end getMenuData



' > $module_name"_module.js"

#return to the main dir
cd ../..

echo '<?php
defined("_JEXEC") or die;


abstract class '$mn_full'Helper  //mod_latestextensionsHelper
{

    public static function getList(&$params)
    {

        $db = JFactory::getDbo();
        $query = $db->getQuery(true);

        $query->select("name, extension_id, type");
        $query->from("#__extensions");
        $query->order("extension_id DESC");
        $db->setQuery($query, 0, $params->get("count",5));

        try
        {
            $results = $db->loadObjectList();
        }
        catch (RuntimeException $e)
        {
            JError::raiseError(500, $e->getMessage());
            return false;
        }

        foreach($results as $k => $result)
        {
            $results[$k] = new stdClass;
            $results[$k]->name = htmlspecialchars($result->name);
            $results[$k]->id = (int)$result->extension_id;
            $results[$k]->type = htmlspecialchars($result->type);
        }

    return $results;

    }

}' > helper.php

echo "<!DOCTYPE html><title></title>" > index.html

echo '<?php
defined("_JEXEC") or die;

require_once __DIR__ . "/helper.php";

$list = mod_'$module_name'Helper::getList($params);//mod_latestextensionsHelper
$moduleclass_sfx = htmlspecialchars($params->get("moduleclass_sfx"));
require JModuleHelper::getLayoutPath("mod_'$module_name'",$params->get("layout","default"));//"mod_latestextensions"


		$module_name = "'$module_name'";//without the "mod_"

        //link JQuery mobile api
        $modLink = JFactory::getDocument();


        $modStyleLoc = JUri::base() . "modules/mod_" . $module_name . "/xfiles/css/" . $module_name . "_module.css";
        $modLink->addStyleSheet($modStyleLoc);


        //mobilemenu javascript file
        $modScriptLoc = JUri::base() . "modules/mod_" . $module_name . "/xfiles/js/" . $module_name . "_module.js";
		$modLink->addScript($modScriptLoc);' > $mn_full".php"

echo '<?xml version="1.0" encoding="utf-8" ?>
<extension type="module"
version="3.0"
method="upgrade"
client="site">
    <name>'$official_title_mod'</name><!-- Latest Extensions -->
    <creationDate>'$my_month_year'</creationDate>
    <author>'$authors_name'</author>
    <authorEmail>'$display_email'</authorEmail>
    <authorUrl>'$display_url'</authorUrl>
    <copyright> (c) '$my_year' '$company_name' llc. all rights reserved.</copyright>
    <license></license>
    <version>1.0.0</version>
    <description>Displays the most recently installed extensions.</description>
    <files>
        <filename module="mod_'$module_name'">mod_'$module_name'.php</filename><!-- module="mod_latestextensions">mod_latestextensions.php -->
        <filename>helper.php</filename>
        <filename>index.html</filename>
        <folder>tmpl</folder>
		<folder>xfiles</folder>
    </files>
    <languages>
        <language tag="en-GB">language/en-GB/en-GB.mod_'$module_name'.ini</language><!-- en-GB.mod_latestextensions.ini -->
    </languages>
    <config>
        <fields name="params">
            <fieldset name="basic">
                <field name="count" type="text" default="5" label="MOD_'$mn_caps'_FIELD_COUNT_LABEL"
                description="MOD_'$mn_caps'_FIELD_COUNT_DESC" />
            </fieldset><!-- label="MOD_LATESTEXTENSIONS_FIELD_COUNT_LABEL"
                description="MOD_LATESTEXTENSIONS_FIELD_COUNT_DESC" -->

            <fieldset name="advanced">
                <field name="moduleclass_sfx" type="text"
                label="COM_MODULES_FIELD_MODULECLASS_SFX_LABEL"
                description="COM_MODULES_FIELD_MODULECLASS_SFX_DESC" />
            </fieldset>
        </fields>
    </config>
</extension>' > $mn_full".xml"

#END MODULE SECTION
#return back to main folder

#back out of module section
cd ..

#make a zip file
zip -r $mn_full"_v1.0.0.zip" $mn_full"_v1.0.0"


cd ../..
echo >"fin_pkg.txt"

#make & enter a temporary folder
mkdir $cn"_temp_pkg"
cd $cn"_temp_pkg"

#copy the pkg xml file into the temp folder
cp "../pkg_"$cn"_v1.0.0/pkg_"$cn".xml" .
#make & enter a  packages directory
mkdir "packages"
cd "packages"

#move the 2 zip files to the temp folder
mv "../../pkg_"$cn"_v1.0.0/packages/"$cn_full"_v1.0.0.zip" .
mv "../../pkg_"$cn"_v1.0.0/packages/"$mn_full"_v1.0.0.zip" .

#leave the temp folder
cd ../..

#turn the temp folder into a zip file
zip -r "pkg_"$cn"_v1.0.0.zip" $cn"_temp_pkg"

#delete the temp folder and all its contents
rm -r $cn"_temp_pkg"

#zip -r $cn_full"_v1.0.0.zip" $cn_full"_v1.0.0"
